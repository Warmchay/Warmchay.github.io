<!DOCTYPE html>


<html lang="zh-CN">


<head>
  <meta charset="utf-8" />
    
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
     Yitee
  </title>
  <meta name="generator" content="hexo-theme-ayer">
  
  <link rel="shortcut icon" href="/favicon.ico" />
  
  
<link rel="stylesheet" href="/dist/main.css">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css">
  
<link rel="stylesheet" href="/css/custom.css">

  
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
  
  

  

<link rel="alternate" href="/atom.xml" title="Yitee" type="application/atom+xml">
</head>

</html>

<body>
  <div id="app">
    
      
    <main class="content on">
      
<section class="cover">
    
      
      <a class="forkMe" href="https://github.com/Warmchay"
        target="_blank"><img width="149" height="149" src="/images/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover1.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">Yitee</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['面朝大海，春暖花开', '温暖纯良，爱与自由', '玻璃晴朗，橘子辉煌'],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  
  

<div class="notice" style="margin-top:50px">
    <i class="ri-heart-fill"></i>
    <div class="notice-content" id="broad"></div>
</div>
<script type="text/javascript">
    fetch('https://v1.hitokoto.cn')
        .then(response => response.json())
        .then(data => {
            document.getElementById("broad").innerHTML = data.hitokoto;
        })
        .catch(console.error)
</script>

<style>
    .notice {
        padding: 20px;
        border: 1px dashed #e6e6e6;
        color: #969696;
        position: relative;
        display: inline-block;
        width: 100%;
        background: #fbfbfb50;
        border-radius: 10px;
    }

    .notice i {
        float: left;
        color: #999;
        font-size: 16px;
        padding-right: 10px;
        vertical-align: middle;
        margin-top: -2px;
    }

    .notice-content {
        display: initial;
        vertical-align: middle;
    }
</style>
  
  <article class="articles">
    
    
    
    
    <article
  id="post-MySQL 学习"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/02/14/MySQL%20%E5%AD%A6%E4%B9%A0/"
    >MySQL基本语法</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2021/02/14/MySQL%20%E5%AD%A6%E4%B9%A0/" class="article-date">
  <time datetime="2021-02-14T06:25:17.191Z" itemprop="datePublished">2021-02-14</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>[TOC]</p>
<h2 id="1-MySQL"><a href="#1-MySQL" class="headerlink" title="1 MySQL"></a>1 MySQL</h2><blockquote>
<p>RDBMS 关系数据库管理系统之一</p>
</blockquote>
<p>mysql语法查询：<a target="_blank" rel="noopener" href="https://www.w3schools.com/sql/func_mysql_floor.asp">w3school整理</a></p>
<h3 id="1-1-definition"><a href="#1-1-definition" class="headerlink" title="1.1 definition"></a>1.1 definition</h3><blockquote>
<p>按照数据结构来组织、存储和管理数据的仓库</p>
</blockquote>
<p>每个数据库都有一个或多个api用于<strong>创建、访问、管理、搜索</strong>和<strong>复制</strong>需要保存的数据。</p>
<p><strong>与io流对比：</strong> 文件读写速度mysql更快</p>
<p><strong>RDBS数据库：</strong> 建立在关系模型基础上的数据库</p>
<p><strong>RDBS特点：</strong></p>
<ul>
<li>数据以表格形式出现</li>
<li>每行为各种记录名称</li>
<li>每列为记录名称所对应的数据与</li>
<li>表单由行和列组成</li>
<li>database由许多表单构成</li>
</ul>
<h3 id="1-2-RDBS"><a href="#1-2-RDBS" class="headerlink" title="1.2 RDBS"></a>1.2 RDBS</h3><img src="https://i.loli.net/2021/03/16/6ZvtElqI3FWLmD2.png" alt="image-20210210173715114.png" style="zoom:50%;" />

<blockquote>
<p>键值具有<strong>唯一性</strong></p>
</blockquote>
<ul>
<li><strong>列：</strong> 一列数据包含着相同类型的数据</li>
<li><strong>行：</strong> 一组相关的数据，一行数据也称为元组，或记录</li>
<li><strong>数据表：</strong> 数据的矩阵，在数据库中像一个简单的电子表格</li>
<li><strong>数据库：</strong> 关联表的集合</li>
<li><strong>冗余：</strong> 存储两倍的数据，<strong>降低了性能</strong>，但<strong>提高了</strong>数据的<strong>安全性</strong></li>
<li><strong>主键：</strong> <font color=red><strong>主键唯一</strong></font>，一个数据表中只能包含一个主键，使用主键来查询数据</li>
<li><strong>外键：</strong> 外键用于关联两个表</li>
<li><strong>复合键：</strong> 又称<strong>组合键</strong>，将多个列作为一个索引键，一般用于复合索引</li>
<li><strong>索引：</strong> 对表中一列或多列的值进行排序的结果，类似书籍的目录，使用索引可以快速访问数据库表表中的特定信息</li>
<li><strong>参照完整性：</strong> 要求关系中<strong>不允许引用不存在的实体</strong>，实体完整性是关系模型中必须满足的完整性约束条件，目的是保证数据的<strong>一致性</strong></li>
</ul>
<h3 id="Appendix-use-mac-to-login-mysql"><a href="#Appendix-use-mac-to-login-mysql" class="headerlink" title="Appendix: use mac to login mysql"></a>Appendix: use mac to login mysql</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h localhost -u root -p</span><br></pre></td></tr></table></figure>

<blockquote>
<p>当mysql运行在服务端时，需要切换到目标文件夹才能使用，不能直接在终端打开</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> \usr\<span class="built_in">local</span>\mysql</span><br></pre></td></tr></table></figure>

<p>后<code>mysql</code>可以直接登录（如果名字为root的话） ，正常方式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h yourip -u yourmysqlname -p</span><br></pre></td></tr></table></figure>

<p>之后输入密码就阔以了</p>
<blockquote>
<p>如果进入mysql后输入mysql命令还是失败，下面这个方法直接解决问题</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">alias</span> mysql = \usr\<span class="built_in">local</span>\mysql\bin\mysql</span><br><span class="line"><span class="built_in">alias</span> mysqladmin = \usr\<span class="built_in">local</span>\mysql\bin\mysqladmin</span><br></pre></td></tr></table></figure>

<blockquote>
<p>虽然不知道为什么，我新一轮使用mysql都要更名一次….</p>
</blockquote>
<p>选用的GUI界面为<a target="_blank" rel="noopener" href="https://sequelpro.com/download#auto-start"><code>Sequal Pro</code></a></p>
<p><strong>参数说明</strong></p>
<ul>
<li><code>-h</code>: 指定客户端需要登陆的mysql的主机名，登陆本机（localhost或者127.0.0.1）时该参数可以忽略</li>
<li><code>-u</code>:登陆的用户名</li>
<li><code>-p</code>:告诉服务器将使用一个密码来登陆，如果无密码，缺省即可</li>
</ul>
<p>输入<code>exit</code>或者<code>quit</code>来退出</p>
<hr>
<h2 id="2-Use-Mysql"><a href="#2-Use-Mysql" class="headerlink" title="2 Use Mysql"></a>2 Use Mysql</h2><h3 id="2-1-Create-Users"><a href="#2-1-Create-Users" class="headerlink" title="2.1 Create Users"></a>2.1 Create Users</h3><p>在尝试了各种debug后，对于我的系统（MacBook Pro OSx 14.6）即使删除了bin目录中的mode，这条插入用户的语句还是用不了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into mysql.user(Host,User,Password) values(&quot;localhost&quot;,&quot;test&quot;,password(&quot;1234&quot;));</span><br></pre></td></tr></table></figure>

<p>查了很多资料，在05年就不提倡上述方法插入用户（虽然我觉得很直观），而是这样的方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT USAGE ON *.* TO &#39;user01&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;123456&#39; WITH GRANT OPTION;</span><br></pre></td></tr></table></figure>

<p>此时用户：<code>user01</code>, 密码为<code>123456</code>。</p>
<p>如果需要赋予该用户修改等操作的权利，需要对所建立的用户进行授权，使用命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP ON tablename.* TO &#39;username&#39;@&#39;localhost&#39; INDENTIFIED BY &#39;password&#39;</span><br></pre></td></tr></table></figure>

<p>相关参数：</p>
<ul>
<li><code>tablename</code>: 替换为授权访问的数据表的table名</li>
</ul>
<blockquote>
<p>这样就为该用户授予了对某数据表的SELECT,INSERT,UPDATE,DELETE,CREATE,DROP的权限</p>
</blockquote>
<p><font color=red><strong>创建用户的最后都需要生效授权后，才算创建完毕</strong></font>, 对应指令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>

<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><blockquote>
<p>仅限于我的系统，对于原有的指令（insert into）说不定你的系统能使用</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use mysql</span><br><span class="line"></span><br><span class="line">mysql&gt; GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP</span><br><span class="line">    -&gt; ON TUTORIALS.*</span><br><span class="line">    -&gt; TO &#39;username&#39;@&#39;localhost&#39;</span><br><span class="line">    -&gt; IDENTIFIED BY &#39;password&#39;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>该指令会在mysql数据库中的user表创建一条用户信息的记录</p>
</blockquote>
<h3 id="2-2-Common-Used-Instructions"><a href="#2-2-Common-Used-Instructions" class="headerlink" title="2.2 Common Used Instructions"></a>2.2 Common Used Instructions</h3><ul>
<li><strong>操作指定的数据库</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use xxx;</span><br><span class="line">Database changed</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>显示mysql中有的数据库列表</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW DATABASES;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<img src="https://i.loli.net/2021/03/16/5ah6AWEBj2pRsIV.png" alt="image-20210214114049857.png" style="zoom:50%;" />

<ul>
<li><strong>显示数据库中所有表</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; run mysql;</span><br><span class="line">Database changed;</span><br><span class="line">mysql&gt; SHOW TABLES;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<img src="https://i.loli.net/2021/03/16/K2LcWyhQkMw9UX4.png" alt="image-20210214114219484.png" style="zoom:50%;" />

<ul>
<li><strong>显示数据表的列信息</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW COLUMNS FROM xxx;</span><br></pre></td></tr></table></figure>

<img src="https://i.loli.net/2021/03/16/owyEaQK7VmX4r13.png" alt="image-20210214114404630.png" style="zoom:50%;" />

<h3 id="2-3-MySQL-connection"><a href="#2-3-MySQL-connection" class="headerlink" title="2.3 MySQL connection"></a>2.3 MySQL connection</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~yourname$ mysql -h localhost -u root -p</span><br></pre></td></tr></table></figure>

<ul>
<li>root可以修改为任何用户</li>
<li>用户权限足够时，任何用户都可以在mysql命令行提示窗口中进行sql操作</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; exit</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure>

<p>退出mysql～</p>
<h3 id="2-4-Create-DB"><a href="#2-4-Create-DB" class="headerlink" title="2.4 Create DB"></a>2.4 Create DB</h3><h4 id="2-4-1-create-directly"><a href="#2-4-1-create-directly" class="headerlink" title="2.4.1 create directly"></a>2.4.1 create directly</h4><ul>
<li><strong>普通用户</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE 数据库名</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>使用mysqladmin 来创建数据库</strong></li>
</ul>
<blockquote>
<p>只有拥有最高权限的root用户才能够使用mysqladmin来创建数据库</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqladmin -u root -p create databaseName</span><br></pre></td></tr></table></figure>

<h4 id="2-4-2-definr-table’s-info"><a href="#2-4-2-definr-table’s-info" class="headerlink" title="2.4.2 definr table’s info"></a>2.4.2 definr table’s info</h4><p>创建数据表需要这些信息：</p>
<ul>
<li>表名</li>
<li>表字段名</li>
<li>定义每个表字段</li>
</ul>
<p>通用语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE table_name(column_name column_type);</span><br></pre></td></tr></table></figure>

<p>实例分析：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS &#96;Try&#96;(</span><br><span class="line">		&#96;id&#96; INT UNSIGNED AUTO_INCREMENT,</span><br><span class="line">		&#96;title&#96; VARCHAR(100) NOT NULL,</span><br><span class="line">		&#96;author&#96; VARCHAR(40) NOT NULL,</span><br><span class="line">		&#96;date&#96; DATE,</span><br><span class="line">		PRIMARY KEY (&#39;id&#39;)</span><br><span class="line">)ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>字段不为null时设置属性为not null，此时如果输入字段的数据为null时，会报错</li>
<li>AUTO_INCREMENT 定义列属性为自增，一般用于主键，数值会自动加1</li>
<li>PRIMARY KEY 定义列为主键，可以使用多列来定义主键，但列间需要以逗号分隔</li>
<li>ENGINE 设置<strong>存储引擎</strong>， CHARSET<strong>设置编码</strong></li>
</ul>
</blockquote>
<h4 id="2-4-3-storage-engines"><a href="#2-4-3-storage-engines" class="headerlink" title="2.4.3 storage engines"></a>2.4.3 storage engines</h4><blockquote>
<p>只记录了重要特点，详细的结构看看这篇<a target="_blank" rel="noopener" href="https://blog.csdn.net/zgrgfr/article/details/74455547">博客</a>吧～</p>
</blockquote>
<h5 id="lt-1-gt-MyISAM"><a href="#lt-1-gt-MyISAM" class="headerlink" title="&lt;1&gt; MyISAM"></a>&lt;1&gt; MyISAM</h5><p><strong>特点：</strong> 插入、查询速度较快，但<strong>不支持事务</strong>，并且数据文件和索引文件放在不同目录下（InnoDB放于同一目录）</p>
<p>使用<strong>B+Tree</strong>作为索引结构，叶子节点的data域内存放的是数据记录的地址。</p>
<h5 id="lt-2-gt-InnoDB"><a href="#lt-2-gt-InnoDB" class="headerlink" title="&lt;2&gt; InnoDB"></a>&lt;2&gt; InnoDB</h5><p><strong>特点：</strong> 事务型数据库的首选引擎，支持事务安全表（ACID），同时支持<strong>行锁定</strong>和<strong>外键</strong>。</p>
<p>表数据文件按照B+Tree来组织的索引结构，同时叶节点保存了完整的数据记录，逻辑关系为：</p>
<blockquote>
<p>索引的key为数据表的主键，InnoDB表数据文件本身为主索引</p>
<p>（所以在InnoDB的表中必须要有主键）</p>
</blockquote>
<p>为<strong>聚集索引</strong></p>
<h5 id="lt-3-gt-MEMORY"><a href="#lt-3-gt-MEMORY" class="headerlink" title="&lt;3&gt; MEMORY"></a>&lt;3&gt; MEMORY</h5><blockquote>
<p>将表中的数据存储到内存当中，为查询和引用其他表数据能提供快速的访问</p>
</blockquote>
<h5 id="lt-4-gt-Archive"><a href="#lt-4-gt-Archive" class="headerlink" title="&lt;4&gt; Archive"></a>&lt;4&gt; Archive</h5><p>如果只有INSERT和SELECT操作，可以选择Archive，因为Archive支持高并发的插入操作，但其本身不是事务安全的，适合存储归档数据，如记录日志信息等</p>
<h4 id="2-5-Delete-DB"><a href="#2-5-Delete-DB" class="headerlink" title="2.5 Delete DB"></a>2.5 Delete DB</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; drop database databaseName;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>使用mysqladmin来删除数据库</strong></li>
</ul>
<blockquote>
<p>不同点在于执行删除命令是，会提示是否真的要删除数据库</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; mysqladmin -u root -p drop databaseName;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>数据类型</strong></li>
</ul>
<p>支持三类：数值，日期和时间及字符串</p>
<h2 id="3-Begin-again"><a href="#3-Begin-again" class="headerlink" title="3 Begin again"></a>3 Begin again</h2><h3 id="3-1-import-data"><a href="#3-1-import-data" class="headerlink" title="3.1 import data"></a>3.1 import data</h3><p> <a href="../Downloads/mysqlsampledatabase.zip">mysqlsampledatabase.zip</a> </p>
<p>将该zip文件解压后，文件在目录不在mysql中，所以需要source xx该<code>.sql</code>文件地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source 「直接将文件拖到终端中」</span><br></pre></td></tr></table></figure>

<h3 id="3-2-verifing-data-table"><a href="#3-2-verifing-data-table" class="headerlink" title="3.2 verifing data table"></a>3.2 verifing data table</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use classicmodel;</span><br><span class="line">database changed</span><br><span class="line">mysql&gt; select * from customers;</span><br></pre></td></tr></table></figure>

<p>可以选择一个你想查看的表。</p>
<img src="https://i.loli.net/2021/03/16/3XKMfY7GTaJqn12.png" alt="image-20210216165605039.png" style="zoom:50%;" />

<p>选择offices表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from offices;</span><br></pre></td></tr></table></figure>

<img src="https://i.loli.net/2021/03/16/SDemUFtcylvduGV.png" alt="image-20210216165652086.png" style="zoom:50%;" />

<h2 id="4-Basic-grammar-—-select-amp-sorting"><a href="#4-Basic-grammar-—-select-amp-sorting" class="headerlink" title="4 Basic grammar — select &amp; sorting"></a>4 Basic grammar — select &amp; sorting</h2><h3 id="4-1-Select-—-Quering-data"><a href="#4-1-Select-—-Quering-data" class="headerlink" title="4.1 Select —- Quering data"></a>4.1 Select —- Quering data</h3><h4 id="4-1-1-single-list"><a href="#4-1-1-single-list" class="headerlink" title="4.1.1 single list"></a>4.1.1 single list</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select list_name</span><br><span class="line">from table_name</span><br></pre></td></tr></table></figure>

<p>以demotable中的<code>employees</code>表为例，在<code>sequel pro</code>中，显示为：</p>
<img src="https://i.loli.net/2021/03/16/JBvVTFrO8afhL1R.png" alt="image-20210217100343106.png" style="zoom:50%;" />

<p>我们取其中的firstName，为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select firstName</span><br><span class="line">from employees;</span><br></pre></td></tr></table></figure>

<p>可以得到：</p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210217100541194.png" alt="image-20210217100541194" style="zoom:38%;" />

<blockquote>
<p>注意这里需要先<code>use classicmodel</code></p>
</blockquote>
<h4 id="4-1-2-multi-lists"><a href="#4-1-2-multi-lists" class="headerlink" title="4.1.2 multi-lists"></a>4.1.2 multi-lists</h4><p>想取表中多个列时，各列间以<code>,</code>分隔。依旧以employees表为例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">lastName,</span><br><span class="line">firstName,</span><br><span class="line">email</span><br><span class="line">from employees;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210217101119655.png" alt="image-20210217101119655" style="zoom:50%;" />

<h4 id="4-1-3-all-columns"><a href="#4-1-3-all-columns" class="headerlink" title="4.1.3 all-columns"></a>4.1.3 all-columns</h4><p>使用asterisk($*$)，表示<code>select star</code> ,<code>select all</code>,依旧以<code>employees</code>表为例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select *</span><br><span class="line">from employees;</span><br></pre></td></tr></table></figure>

<p>但在实际使用中会出现以下问题：</p>
<ul>
<li>当列很多时，处理器可能会爆；</li>
<li>如果后面有同事加入其他冗余列，查找需要列就会变得十分复杂；</li>
<li>给别人expose时，可能会暴露隐私信息。</li>
</ul>
<h3 id="4-2-Order-by-—-sorting-data"><a href="#4-2-Order-by-—-sorting-data" class="headerlink" title="4.2 Order by — sorting data"></a>4.2 Order by — sorting data</h3><h4 id="4-2-1-concept"><a href="#4-2-1-concept" class="headerlink" title="4.2.1 concept"></a>4.2.1 concept</h4><blockquote>
<p>在这里： <code>ASC</code>为ascend，表示升序sorting；<code>DESC</code>为descend，表示降序sorting</p>
</blockquote>
<p><font color=red><strong>使用<code>order by</code> 缺省时，默认为<code>ASC</code>.</strong></font></p>
<h4 id="4-2-2-multi-columns-op"><a href="#4-2-2-multi-columns-op" class="headerlink" title="4.2.2 multi-columns op"></a>4.2.2 multi-columns op</h4><p>举个栗子，依旧是我们可爱的<code>employees</code> table，在一开始时先选定database中的目标表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select list_name</span><br><span class="line">form table_name</span><br><span class="line">order by</span><br><span class="line">column1 [ASC|DESC],</span><br><span class="line">column2 [ASC|DESC];</span><br></pre></td></tr></table></figure>

<blockquote>
<p>here’s column_2 is permmitted by the list_name have multi-columns「即至少选择了两个列～」</p>
</blockquote>
<p>栗子中的EMPLOYEES表为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select lastName,</span><br><span class="line">employeeNumber</span><br><span class="line">from employees</span><br><span class="line">order by</span><br><span class="line">lastName DESC,</span><br><span class="line">employeeNumber desc;</span><br></pre></td></tr></table></figure>

<p>Demo:</p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210217103522004.png" alt="image-20210217103522004" style="zoom:50%;" />

<blockquote>
<p>Demostrate: in letter, it was descended by ‘z-a’; in number, ….</p>
</blockquote>
<h4 id="4-2-3-create-specified-column-by-chosen-lists"><a href="#4-2-3-create-specified-column-by-chosen-lists" class="headerlink" title="4.2.3 create specified column by chosen lists"></a>4.2.3 create specified column by chosen lists</h4><p>使用classicmodels中的<code>orderdetails</code>进行操作：</p>
<p>在该表中有<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210217104620898.png" alt="image-20210217104620898" style="zoom:50%;" /></p>
<p>为了使营业额和顾客重要程度显示的更清楚，选取<code>orderNumber</code>，<code>orderLineNumber</code> 并列后，以$quantityOrdered\ *\ priceEach\quad desc;$来排序整个表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">ordernumber,</span><br><span class="line">orderlinenumber,</span><br><span class="line">quantityordered * priceeach</span><br><span class="line">from orderdetails</span><br><span class="line">order by</span><br><span class="line">quantityordered * priceeach desc;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210217105015878.png" alt="image-20210217105015878" style="zoom:50%;" />

<blockquote>
<p>为了使数据更加visualization，可以将新增列重新命名</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">ordernumber,</span><br><span class="line">orderlinenumber,</span><br><span class="line">quantityordered * priceeach as subtotal</span><br><span class="line">from orderdetails</span><br><span class="line">order by</span><br><span class="line">subtotal desc;</span><br></pre></td></tr></table></figure>

<p><strong>Demo</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210217110105849.png" alt="image-20210217110105849" style="zoom:50%;" />

<h4 id="4-2-4-identified-sorting-function"><a href="#4-2-4-identified-sorting-function" class="headerlink" title="4.2.4 identified sorting function"></a>4.2.4 identified sorting function</h4><p>使用<code>field(value, str1, str2, str3, str4)</code>在每次对比表中的数据时通过对比<code>str(x)</code>与<code>value</code>返回对应值，如果该值不存在，返回0.</p>
<p>以<code>orders</code>表中的<code>status</code>为例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select orderNumber, status </span><br><span class="line">from orders </span><br><span class="line">order by </span><br><span class="line">field(status, &#39;In Process&#39;, &#39;On Hold&#39;, &#39;Cancelled&#39;, &#39;Resolved&#39;, &#39;Disputed&#39;, &#39;Shipped&#39;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在这里被选取的列的排列顺序由<code>status</code>决定</p>
</blockquote>
<h2 id="5-Basic-grammar-—-filtering-data"><a href="#5-Basic-grammar-—-filtering-data" class="headerlink" title="5 Basic grammar — filtering data"></a>5 Basic grammar — filtering data</h2><h3 id="5-1-where"><a href="#5-1-where" class="headerlink" title="5.1 where"></a>5.1 where</h3><blockquote>
<p>使用久违的<code>employees table～～～</code></p>
</blockquote>
<p>在执行过程中的logically executing followings as expressed:<br>$$<br>where \Rightarrow from \Rightarrow select \Rightarrow order\ by<br>$$</p>
<h4 id="5-1-1-search-the-same-value"><a href="#5-1-1-search-the-same-value" class="headerlink" title="5.1.1 search the same value"></a>5.1.1 search the same value</h4><p>将一列中等值行提取出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">lastName, firstName, jobTitle </span><br><span class="line">from employees </span><br><span class="line">where jobTitle &#x3D; &#39;Sales Rep&#39;;</span><br></pre></td></tr></table></figure>

<p><strong>demo：</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210217120103282.png" alt="image-20210217120103282" style="zoom:50%;" />

<h4 id="5-1-2-logically-ops"><a href="#5-1-2-logically-ops" class="headerlink" title="5.1.2 logically ops"></a>5.1.2 logically ops</h4><p>在提取列的时候可以使用逻辑运算：<code>AND,OR,BETWEEN,LIKE,IN, IS NULL</code>，逻辑运算符也可以使用：<code>&gt;=,&lt;=,!= ...</code>。选几个讲一下</p>
<ul>
<li><code>between low(value) and high(value)</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select lastName, firstName, jobTitle, officeCode </span><br><span class="line">from employees </span><br><span class="line">where </span><br><span class="line">officeCode between 1 and 3;</span><br></pre></td></tr></table></figure>

<p>返回officecode在1～3的行</p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210217121117655.png" alt="image-20210217121117655" style="zoom:50%;" />

<ul>
<li><code>LIKE &#39;str&#39;</code></li>
</ul>
<p>like通过通配符<code>%</code>,<code>_</code>来匹配特定字符串，其中<code>%</code>代表多个字母或空字符，而<code>_</code>仅代表任意一个字母</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select lastName, firstName, jobTitle, officeCode </span><br><span class="line">from employees </span><br><span class="line">where jobTitle like &#39;%ep&#39;;</span><br></pre></td></tr></table></figure>

<p>通配后缀为<code>ep</code>的数据：</p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210217121532213.png" alt="image-20210217121532213" style="zoom:50%;" />

<ul>
<li><code>IN (VALUE1,VALUE2,VALUE3)</code></li>
</ul>
<p>between是范围查找，in是特定值查找</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select lastName, firstName, jobTitle, officeCode </span><br><span class="line">from employees </span><br><span class="line">where officeCode in (1,4,6)</span><br><span class="line">order by </span><br><span class="line">officecode;</span><br></pre></td></tr></table></figure>

<p>提取出officeCode为<code>1,4,6</code>的用户：</p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210217122325752.png" alt="image-20210217122325752" style="zoom:50%;" />

<ul>
<li><code>IS NULL</code>用来查找是否有用户该值为空，为空返回1，显示出来</li>
</ul>
<blockquote>
<p>这个就不demo了，因为要吃饭了qwq</p>
</blockquote>
<p><strong>特殊的是：</strong> 在逻辑运算符中<code>!=</code>与<code>&lt;&gt;</code>同样表示不等关系</p>
<h3 id="5-2-distinct"><a href="#5-2-distinct" class="headerlink" title="5.2 distinct"></a>5.2 distinct</h3><blockquote>
<p>operating table : <code>employees</code></p>
</blockquote>
<p>在filter类的操作中，distinct用来消除duplicate rows，使table更加整洁</p>
<h4 id="5-2-1-basic-usage"><a href="#5-2-1-basic-usage" class="headerlink" title="5.2.1 basic usage"></a>5.2.1 basic usage</h4><p>先来看看表的数据是否重复：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select lastName </span><br><span class="line">from employees </span><br><span class="line">order by lastName;</span><br></pre></td></tr></table></figure>

<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210217123041888.png" alt="image-20210217123041888" style="zoom:38%;" />

<p>有多个值重复，用<code>distinct</code>消灭它们～</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">distinct lastName </span><br><span class="line">from employees </span><br><span class="line">order by lastName;</span><br></pre></td></tr></table></figure>

<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210217123215931.png" alt="image-20210217123215931" style="zoom:38%;" />

<blockquote>
<p>如果表中有空值，会被消除到只剩一个，因为处理器将<code>NULL</code>值视为same value。因此在每次操作时，最好使用where来避免null值的出现</p>
</blockquote>
<ul>
<li><strong>多列消除重复值</strong></li>
</ul>
<blockquote>
<p>using table: customers</p>
</blockquote>
<p>先取出要消除的列：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select </span><br><span class="line">    -&gt; state, city</span><br><span class="line">    -&gt; from customers</span><br><span class="line">    -&gt; where state is not NULL</span><br><span class="line">    -&gt; ordered by state;</span><br></pre></td></tr></table></figure>

<p>得到相关子表：</p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210217124707836.png" alt="image-20210217124707836" style="zoom:50%;" />

<p>来保留不同的state-city，加个<code>distinct</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">distinct state, city </span><br><span class="line">from customers </span><br><span class="line">where state is not NULL </span><br><span class="line">order by state;</span><br></pre></td></tr></table></figure>

<h4 id="5-2-2-distinct-vs-group-by"><a href="#5-2-2-distinct-vs-group-by" class="headerlink" title="5.2.2 distinct $vs$ group by"></a>5.2.2 distinct $vs$ group by</h4><p>消除效果相同，呈现效果的差异体现在：</p>
<ol>
<li>加的位置不同；</li>
<li>group by最后呈现的结果是<code>ASC</code>的</li>
</ol>
<ul>
<li><code>distinct</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">distinct state</span><br><span class="line">from customers;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>group by</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">state</span><br><span class="line">from customers </span><br><span class="line">group by state;</span><br></pre></td></tr></table></figure>

<h4 id="5-2-3-relevant-aggregate-functions"><a href="#5-2-3-relevant-aggregate-functions" class="headerlink" title="5.2.3 relevant aggregate functions"></a>5.2.3 relevant aggregate functions</h4><h5 id="lt-1-gt-sum-类"><a href="#lt-1-gt-sum-类" class="headerlink" title="&lt;1&gt; sum 类"></a>&lt;1&gt; sum 类</h5><p>将不重复值统计的函数有：<code>SUM</code>, <code>AVG</code>及<code>COUNT</code></p>
<p>举个栗子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">COUNT(state) </span><br><span class="line">from customers </span><br><span class="line">WHERE state&#x3D;&#39;NV&#39;;</span><br></pre></td></tr></table></figure>

<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210217130837321.png" alt="image-20210217130837321" style="zoom:50%;" />

<h5 id="lt-2-gt-limit"><a href="#lt-2-gt-limit" class="headerlink" title="&lt;2&gt; limit"></a>&lt;2&gt; limit</h5><p>显示表limit value的前value列</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">distinct state </span><br><span class="line">from customers </span><br><span class="line">where state is not null </span><br><span class="line">limit 5;</span><br></pre></td></tr></table></figure>

<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210217131111534.png" alt="image-20210217131111534" style="zoom:50%;" />

<h2 id="6-Joining-tables"><a href="#6-Joining-tables" class="headerlink" title="6  Joining tables"></a>6  Joining tables</h2><h3 id="6-1-Columns-alias"><a href="#6-1-Columns-alias" class="headerlink" title="6.1 Columns alias"></a>6.1 Columns alias</h3><p>通过选取列，选择合并的函数<code>expression</code>来重新alias列：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">[column_1 | expression] as &#39;change_name&#39;</span><br><span class="line">from </span><br><span class="line">table_name;</span><br></pre></td></tr></table></figure>

<p>选我们熟悉的<code>employees</code>作为演示吧：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">concat_ws(&#39;,&#39;, lastName, firstName) as &#39;Full name&#39; </span><br><span class="line">from employees </span><br><span class="line">order by &#39;Full name&#39;;</span><br></pre></td></tr></table></figure>

<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210218144331517.png" alt="image-20210218144331517" style="zoom:50%;" />

<ul>
<li><code>concat_ws()</code>作为<code>concatenate</code>函数，连接列</li>
<li><code>as</code>可省去，但略过了会缺少可读性</li>
<li><code>group by</code>, <code>having</code>, <code>order by</code>都能够使用</li>
<li><code>where</code>在这里不能使用，mysql在这种情况下处理where语句时会忽略<code>select</code>中的列</li>
<li><code>having</code>的用于筛选出specified column中符合having <code>range</code>中于<code>range</code>的值</li>
</ul>
<p><strong>summary：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">orderNumber &#96;order no.&#96;, </span><br><span class="line">sum(quantityOrdered * priceEach) total </span><br><span class="line">from orderdetails </span><br><span class="line">group by &#96;order no.&#96; </span><br><span class="line">having total &gt; 60000;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>having</code>需要和<code>group by</code>联合使用</li>
</ul>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210218150119595.png" alt="image-20210218150119595" style="zoom:50%;" />

<h3 id="6-2-Table-alias-–-Join"><a href="#6-2-Table-alias-–-Join" class="headerlink" title="6.2 Table alias – Join"></a>6.2 Table alias – Join</h3><blockquote>
<p>table 的一般alias使用的方法为：<code>inner join</code>, <code>left join</code>, <code>right join</code> , <code>cross join</code>and in <code>subqueries</code>.</p>
<p>目前mysql还不支持<code>full outer join</code>方法</p>
<p>join方法一般用于处理事务关系型数据库，避免出现<code>ambiguous error</code>的问题</p>
</blockquote>
<h4 id="6-2-1-simple-alias"><a href="#6-2-1-simple-alias" class="headerlink" title="6.2.1 simple alias"></a>6.2.1 simple alias</h4><p>将table别名后，使用<code>.</code>调用即可，通用格式为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select *</span><br><span class="line">from table_name (as) alias_name</span><br></pre></td></tr></table></figure>

<p>依旧是可爱的<code>employees</code>表～</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select  </span><br><span class="line">concat_ws(&#39;,&#39;, e.lastName, e.firstName) &#39;Full name&#39; </span><br><span class="line">from employees e </span><br><span class="line">order by &#39;Full name&#39;;</span><br></pre></td></tr></table></figure>

<p>结果跟之前列合并的demo没区别～</p>
<h4 id="6-2-2-Setting-up-sample-table"><a href="#6-2-2-Setting-up-sample-table" class="headerlink" title="6.2.2 Setting up sample table"></a>6.2.2 Setting up sample table</h4><p>为了更好的展现功能，先创建个可以乱用的表格吧～</p>
<p>这里直接开始创建了，后面会详细解释各个属性的创建流程</p>
<ol>
<li><strong>Creating two tables</strong></li>
</ol>
<blockquote>
<p>members &amp; commitees</p>
<p>ovo, committee 拼错了，但我不想改了qwq</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table members(</span><br><span class="line">    -&gt; member_id INT AUTO_INCREMENT,</span><br><span class="line">    -&gt; name VARCHAR(100),</span><br><span class="line">    -&gt; PRIMARY KEY(&#39;member_id&#39;)</span><br><span class="line">    -&gt; );</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table commitees(</span><br><span class="line">    -&gt; commitee_id INT AUTO_INCREMENT,</span><br><span class="line">    -&gt; name VARCHAR(100),</span><br><span class="line">    -&gt; PRIMARY KEY(commitee_id)</span><br><span class="line">    -&gt; );</span><br></pre></td></tr></table></figure>

<ul>
<li><code>AUTO_INCREMENT</code>为表中<code>id</code>自动自增的定义</li>
</ul>
<blockquote>
<p>文章中2.4.2 提到过一点点</p>
</blockquote>
<ol start="2">
<li><strong>Insert datas</strong></li>
</ol>
<p>采用格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">insert into </span><br><span class="line">table_name(create_column_name)</span><br><span class="line">values(&#39;&#39;)(&#39;&#39;)...(&#39;&#39;)</span><br></pre></td></tr></table></figure>

<ul>
<li>在同一列中创建的<code>values</code>值依序排列</li>
<li><font color=red><strong>注意values与<code>table_name(...)</code>间没有分隔符</strong></font></li>
</ul>
<p><strong>demo：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">insert into </span><br><span class="line">members(name)</span><br><span class="line">values(&#39;joe&#39;),(&#39;jane&#39;),(&#39;mary&#39;),(&#39;selina&#39;),(&#39;haha&#39;);</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into </span><br><span class="line">    -&gt; commitees(name)</span><br><span class="line">    -&gt; values(&#39;qwq&#39;),(&#39;ovo&#39;),(&#39;mary&#39;),(&#39;selina&#39;),(&#39;qaq&#39;);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>Quering datas</strong></li>
</ol>
<ul>
<li><code>members</code>:</li>
</ul>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210218154502490.png" alt="image-20210218154502490" style="zoom:50%;" />

<ul>
<li><code>commitees</code>:</li>
</ul>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210218154528060.png" alt="image-20210218154528060" style="zoom:45%;" />

<h4 id="6-2-3-inner-join"><a href="#6-2-3-inner-join" class="headerlink" title="6.2.3 inner join"></a>6.2.3 inner join</h4><p>内部的排布，可以看作是集合中的交集，<code>inner join</code>会新开列来存储两张表中存在符合<code>join_condition</code>的数据，一般使用格式为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select column_list</span><br><span class="line">from table1_name</span><br><span class="line">inner join table2_name on join_condition</span><br></pre></td></tr></table></figure>

<ul>
<li>为了方便表示，<code>column_list</code>包含多个<code>column</code>，而<code>column_name</code>仅表示specified column.</li>
</ul>
<p>当这两个表格的需要<code>join</code>的列名相同时，可以使用<code>using(column_name)</code>来合并，即：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select column_list</span><br><span class="line">from table1_name</span><br><span class="line">inner join table2_name using (column_name)</span><br></pre></td></tr></table></figure>

<p>举个栗子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select </span><br><span class="line">    -&gt; m.member_id,</span><br><span class="line">    -&gt; m.name as member,</span><br><span class="line">    -&gt; c.commitee_id,</span><br><span class="line">    -&gt; c.name as commitee</span><br><span class="line">    -&gt; from members m</span><br><span class="line">    -&gt; inner join commitees c on m.name&#x3D;c.name;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>join_condition</code>决定了产生的列是什么</p>
</blockquote>
<ul>
<li>在<code>column_list</code>中要把需要合并的两列都表示出来，如果列同名但没有表示的话，会出现<code>ambigous error</code></li>
</ul>
<p><strong>Demo:</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210218160531098.png" alt="image-20210218160531098" style="zoom:50%;" />

<blockquote>
<p>显示交集对象</p>
</blockquote>
<p>使用<code>using(...)</code>得到的结果相同：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select </span><br><span class="line">    -&gt; m.member_id,</span><br><span class="line">    -&gt; m.name as member,</span><br><span class="line">    -&gt; c.commitee_id,</span><br><span class="line">    -&gt; c.name as commitee</span><br><span class="line">    -&gt; from members m</span><br><span class="line">    -&gt; inner join commitees c using(name);</span><br></pre></td></tr></table></figure>

<h4 id="6-2-4-left-join"><a href="#6-2-4-left-join" class="headerlink" title="6.2.4 left join"></a>6.2.4 left join</h4><p>$$<br>Left \ join(A, B) = A<br>$$</p>
<p>对于B中的元素，若有$b\notin A$，将$b$所对应的所有属性设为<code>null</code>.</p>
<p><strong>Venn图表示为：</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210218165153861.png" alt="image-20210218165153861" style="zoom:50%;" />

<p>举个栗子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select </span><br><span class="line">    -&gt; m.member_id,</span><br><span class="line">    -&gt; m.name as member,</span><br><span class="line">    -&gt; c.commitee_id,</span><br><span class="line">    -&gt; c.name as commitee</span><br><span class="line">    -&gt; from members as m</span><br><span class="line">    -&gt; left join commitees as c using(name);</span><br></pre></td></tr></table></figure>

<p><strong>Demo：</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210218165303052.png" alt="image-20210218165303052" style="zoom:50%;" />

<p>如果只想保留$A\overline{B}$，通过<code>where</code>来实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">m.member_id, </span><br><span class="line">m.name as member, </span><br><span class="line">c.commitee_id, </span><br><span class="line">c.name as commitee </span><br><span class="line">from members as m left </span><br><span class="line">join commitees as c using(name) </span><br><span class="line">where c.name is null;</span><br></pre></td></tr></table></figure>

<p><strong>Demo：</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210218165657012.png" alt="image-20210218165657012" style="zoom:50%;" />

<p>简化版：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">m.member_id, </span><br><span class="line">m.name as member, </span><br><span class="line">from members as m left </span><br><span class="line">join commitees as c using(name) </span><br><span class="line">where c.name is null;</span><br></pre></td></tr></table></figure>

<p><strong>Demo:</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210218165749727.png" alt="image-20210218165749727" style="zoom:50%;" />

<blockquote>
<p>RIGHT JOIN 就是把B跟A的关系换了一下，不再赘述了</p>
</blockquote>
<h4 id="6-2-5-cross-join"><a href="#6-2-5-cross-join" class="headerlink" title="6.2.5 cross join"></a>6.2.5 cross join</h4><p>与之前提过的<code>join</code>方法不同的是，<code>cross join</code>没有<code>join_condition</code></p>
<p><code>cross join</code>可以表示为集合<code>A</code>中每个元素都与集合<code>B</code>中每个元素产生映射关系，假设集合<code>A</code>中有<code>m</code>个元素，集合<code>B</code>中有<code>n</code>个元素，建立的映射关系一共会产生$n\times m$ 行。</p>
<p>举个栗子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">m.member_id, </span><br><span class="line">m.name as member, </span><br><span class="line">c.commitee_id,  </span><br><span class="line">c.name as commitee </span><br><span class="line">from members as m </span><br><span class="line">cross join commitees c;</span><br></pre></td></tr></table></figure>

<p><strong>Demo：</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210219102652885.png" alt="image-20210219102652885" style="zoom:40%;" />

<blockquote>
<p>可以看到，对于members中每一位对象都会与commitee对象进行一对一的映射</p>
</blockquote>
<h3 id="6-3-self-join-table"><a href="#6-3-self-join-table" class="headerlink" title="6.3 self-join table"></a>6.3 self-join table</h3><blockquote>
<p>一般用于处理表中的hierarchical data，即将上下级关系直观表述出</p>
</blockquote>
<p>对<code>employees</code>表中的<code>employeeNumber</code>与<code>reportsTo</code>展示上下属关系</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select  </span><br><span class="line">concat_ws(&#39;,&#39;,e.lastName,e.firstName) as manager, concat_ws(&#39;,&#39;,r.lastName,r.firstName) as engineer </span><br><span class="line">from employees e </span><br><span class="line">inner join employees r on e.employeeNumber&#x3D;r.reportsTo;</span><br></pre></td></tr></table></figure>

<p><strong>Demo:</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210219104253044.png" alt="image-20210219104253044" style="zoom:50%;" />

<p>通过这个方法体现上下属关系，但问题来了，最高级领导怎么办呢？</p>
<blockquote>
<p>最高级领导因为reportsTo为<code>NULL</code>显示不出</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">    IFNULL(CONCAT(m.lastname, &#39;, &#39;, m.firstname),</span><br><span class="line">            &#39;Top Manager&#39;) AS &#39;Manager&#39;,</span><br><span class="line">    CONCAT(e.lastname, &#39;, &#39;, e.firstname) AS &#39;Direct report&#39;</span><br><span class="line">FROM</span><br><span class="line">    employees e</span><br><span class="line">LEFT JOIN employees m ON </span><br><span class="line">    m.employeeNumber &#x3D; e.reportsto</span><br><span class="line">ORDER BY </span><br><span class="line">    manager DESC;</span><br></pre></td></tr></table></figure>

<p><strong>Demo:</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210219112746638.png" alt="image-20210219112746638" style="zoom:50%;" />

<p>这样能显示出最高级。</p>
<ul>
<li><code>concat_ws(&#39;signal&#39;, str1, str2, ...)</code>,将各个<code>str</code>用<code>signal</code>连接起来，而<code>concat(str1,&#39;signal&#39;,str2,&#39;signal&#39;,...)</code>则是将各个<code>str</code>以特定的<code>signal</code>连接起来</li>
<li><code>ifnull(expression | judgeValue)</code>对于符合条件的<code>expression</code>返回<code>expression</code>,否则返回<code>judgeValue</code></li>
</ul>
<h2 id="7-Grouping-Data"><a href="#7-Grouping-Data" class="headerlink" title="7 Grouping Data"></a>7 Grouping Data</h2><blockquote>
<p>MySQL 在执行过程中按照一定顺序对数据处理，不能改变流程执行的顺序</p>
</blockquote>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210219114012596.png" alt="image-20210219114012596" style="zoom:50%;" />

<p>因此group by注意放在<code>from, where, select</code>后面</p>
<p>使用group by的场景下一般使用集合合并的函数<code>sum, count, avg, max, min etc.</code></p>
<h3 id="7-1-simple-group"><a href="#7-1-simple-group" class="headerlink" title="7.1 simple group"></a>7.1 simple group</h3><blockquote>
<p>group by 将同一类的总和在一起，显示某个column中一共有多少不同的类别</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select status</span><br><span class="line">    -&gt; from orders</span><br><span class="line">    -&gt; group by status;</span><br></pre></td></tr></table></figure>

<p><strong>Demo:</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210219115743895.png" alt="image-20210219115743895" style="zoom:50%;" />

<p>group by的简单实现与<code>distinct</code>实现方式相同：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select distinct status</span><br><span class="line">    -&gt; from orders</span><br></pre></td></tr></table></figure>

<h3 id="7-2-use-aggregate-function"><a href="#7-2-use-aggregate-function" class="headerlink" title="7.2 use aggregate function"></a>7.2 use aggregate function</h3><h4 id="7-2-1-statistics-of-a-group"><a href="#7-2-1-statistics-of-a-group" class="headerlink" title="7.2.1 statistics of a group"></a>7.2.1 statistics of a group</h4><blockquote>
<p>使用<code>count(*)</code>来进行统计</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select</span><br><span class="line">    -&gt; status, count(*)</span><br><span class="line">    -&gt; from orders</span><br><span class="line">    -&gt; group by status;</span><br></pre></td></tr></table></figure>

<p><strong>Demo:</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210219120342983.png" alt="image-20210219120342983" style="zoom:50%;" />

<p>由此，统计出各类别的所包含的对象数量</p>
<h4 id="7-2-2-statistics-of-some-groups"><a href="#7-2-2-statistics-of-some-groups" class="headerlink" title="7.2.2 statistics of some groups"></a>7.2.2 statistics of some groups</h4><p>在统计多个数据时，将有关联的两张表数据通过<code>join</code>的方式呈现</p>
<p>举个栗子：对于所给的database中的<code>orders</code>及<code>orderdetails</code>中相关联的是<code>orderNumber</code>的细节数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select </span><br><span class="line">    -&gt; status, sum(quantityOrdered * priceEach) as counting</span><br><span class="line">    -&gt; from orders</span><br><span class="line">    -&gt; inner join orderdetails using(orderNumber)</span><br><span class="line">    -&gt; group by status;</span><br></pre></td></tr></table></figure>

<p>由此得到每个类别的经营总额：</p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210219121910618.png" alt="image-20210219121910618" style="zoom:50%;" />

<p>同样的，可以使用相同方法对单个<code>orderNumber</code>进行操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select</span><br><span class="line">    -&gt; orderNumber, sum(quantityOrdered * priceEach) as &#39;total sum&#39;</span><br><span class="line">    -&gt; from orderdetails</span><br><span class="line">    -&gt; group by orderNumber;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>group by</code>限定了是以<code>orderNumber asc</code>的顺序呈现，这个时候加了<code>order by</code>也没有用，体现了这两个命令的优先级别；</li>
<li><code>sum</code>统计的是前一个属性下的对应值总和。在这里计算得为<code>orderNumber</code>的总额</li>
</ul>
<h4 id="7-2-3-other-functions-to-deploy"><a href="#7-2-3-other-functions-to-deploy" class="headerlink" title="7.2.3 other functions to deploy"></a>7.2.3 other functions to deploy</h4><blockquote>
<p>使用Year()来集合同一年份的营业数量</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select</span><br><span class="line">    -&gt; year(orderDate) year,</span><br><span class="line">    -&gt; sum(quantityOrdered * priceEach) as &#39;total&#39;,</span><br><span class="line">    -&gt; status</span><br><span class="line">    -&gt; from orders</span><br><span class="line">    -&gt; inner join orderdetails using(orderNumber)</span><br><span class="line">    -&gt; where status&#x3D;&#39;Shipped&#39;</span><br><span class="line">    -&gt; group by year;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>year()</code>统计年份的标准函数</li>
</ul>
<p><strong>Demo：</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210219124012330.png" alt="image-20210219124012330" style="zoom:50%;" />

<p>进一步筛选2003年以后的营业额，在group by后添加：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-&gt; having year&gt;2003;</span><br></pre></td></tr></table></figure>

<h3 id="7-3-roll-up"><a href="#7-3-roll-up" class="headerlink" title="7.3 roll up"></a>7.3 roll up</h3><blockquote>
<p>选定已有表的数据复制到新表中</p>
</blockquote>
<h3 id="7-3-1-create-sales-table"><a href="#7-3-1-create-sales-table" class="headerlink" title="7.3.1 create sales table"></a>7.3.1 create sales table</h3><p>从<code>orders</code>, <code>orderdetails</code>, <code>products</code>三个表中得到相关数据，获取各个<code>productline</code>在不同年份的经营总额</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table sales</span><br><span class="line">    -&gt; select</span><br><span class="line">    -&gt; productline,</span><br><span class="line">    -&gt; year(orderdate) year,</span><br><span class="line">    -&gt; sum(quantityordered * priceeach) as &#39;orderTotal&#39;</span><br><span class="line">    -&gt; from orderdetails</span><br><span class="line">    -&gt; inner join orders using(orderNumber)</span><br><span class="line">    -&gt; inner join products using(productcode)</span><br><span class="line">    -&gt; group by productline,year;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>inner join</code>使用两次中间不需要用分隔符来分开</li>
<li><code>group by</code>的排列依据的是第一个项</li>
<li><font color=red><strong>合并表间关系时先找出中间联系表</strong></font></li>
</ul>
<p><strong>Demo:</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210220105213622.png" alt="image-20210220105213622" style="zoom:50%;" />

<p>将这几个年份车间的总额统计，直接使用<code>group by</code>来统计</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">productline,</span><br><span class="line">sum(orderTotal) as &#39;total&#39;</span><br><span class="line">from sales</span><br><span class="line">group by productline;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>上面的demo图是第一次尝试使用命名的列<code>priceTotal</code>，但在下一次建立新表时使用的是<code>orderTotal</code>，因此后面的数据都用<code>orderTotal</code>来表示，数值上与<code>priceTotal</code>相等</p>
</blockquote>
<p><strong>Demo:</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210220105445591.png" alt="image-20210220105445591" style="zoom:50%;" />

<p><strong>做个三年营业总额统计！</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">sum(orderTotal) as &#39;totalSum&#39;</span><br><span class="line">from sales;</span><br></pre></td></tr></table></figure>

<p><strong>Demo:</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210220110059750.png" alt="image-20210220110059750" style="zoom:40%;" />

<h3 id="7-3-2-roll-up-ops"><a href="#7-3-2-roll-up-ops" class="headerlink" title="7.3.2 roll up ops"></a>7.3.2 roll up ops</h3><blockquote>
<p><code>roll up</code>具体为在最后一行设<code>primary key = null</code>，其余属性为数值总和</p>
</blockquote>
<ul>
<li><code>rollup</code>用于统计相关数据，在<code>select</code>时要注意对<code>rollup</code>需要总和的数据进行<code>sum</code>操作</li>
<li><code>rollup</code>根据元组$(c_1,c_2,…,c_n)$对子集拆分操作为：$(),(c_1),(c_1,c_2)….$</li>
</ul>
<h4 id="lt-1-gt-different-hierachy-table"><a href="#lt-1-gt-different-hierachy-table" class="headerlink" title="&lt;1&gt; different hierachy table"></a>&lt;1&gt; different hierachy table</h4><ul>
<li><code>group by productline, year with rollup</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select productline,</span><br><span class="line">    -&gt; year,</span><br><span class="line">    -&gt; sum(ordertotal) as &#39;total&#39;</span><br><span class="line">    -&gt; from sales</span><br><span class="line">    -&gt; group by productline, year with rollup;</span><br></pre></td></tr></table></figure>

<p><strong>Demo：</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210220113247898.png" alt="image-20210220113247898" style="zoom:40%;" />

<blockquote>
<p>在展示了<code>productline</code>不同年份下的营业额后，加入<code>rollup</code>作用的一行<code>null</code> 加总额<code>totalSum</code></p>
</blockquote>
<p><strong>此时的排列关系为：</strong> $productLine &gt; year$</p>
<ul>
<li><code>group by year, productline with rollup</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select</span><br><span class="line">    -&gt; productline,</span><br><span class="line">    -&gt; year, </span><br><span class="line">    -&gt; sum(ordertotal) as &#39;total&#39;</span><br><span class="line">    -&gt; from sales</span><br><span class="line">    -&gt; group by </span><br><span class="line">    -&gt; year, productline with rollup;</span><br></pre></td></tr></table></figure>

<p><strong>Demo:</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210220113611776.png" alt="image-20210220113611776" style="zoom:40%;" />

<blockquote>
<p>hierarchy 关系改变顺序后，展示的是不同年份下所有车间的经营总额</p>
</blockquote>
<p><strong>此时的继承关系为：</strong> $year &gt; productLine$</p>
<h4 id="lt-2-gt-grouping-function"><a href="#lt-2-gt-grouping-function" class="headerlink" title="&lt;2&gt; grouping function"></a>&lt;2&gt; grouping function</h4><blockquote>
<p>用于识别<code>null</code>是<code>subtotal</code>还是<code>grand total</code></p>
</blockquote>
<ul>
<li><code>grouping()</code>用于检测某一行是否为子<code>null</code>，当为<code>grand total</code>时返回1，反之返回<code>0</code>。用于<code>select</code>中</li>
<li>使用<code>grouping()</code>会新开关于<code>grouping()</code>的结果列</li>
</ul>
<blockquote>
<p>想举个栗子，但是发现mysql 5.x版本还不支持这个功能，仅支持<code>8.x</code>版本</p>
</blockquote>
<p>一般这么使用就阔以了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select </span><br><span class="line">    -&gt; productline,</span><br><span class="line">    -&gt; year,</span><br><span class="line">    -&gt; sum(ordertotal) as &#39;total&#39;,</span><br><span class="line">    -&gt; grouping(productline),</span><br><span class="line">    -&gt; grouping(year)</span><br><span class="line">    -&gt; from sales</span><br><span class="line">    -&gt; group by</span><br><span class="line">    -&gt; productline, year</span><br><span class="line">    -&gt; with rollup;</span><br></pre></td></tr></table></figure>

<p>自己试试吧，orz</p>
<p>如果想让总额更加美观，不是只显示<code>null</code>的话，使用<code>if</code>来实现</p>
<h4 id="lt-3-gt-IF-FUNCTION"><a href="#lt-3-gt-IF-FUNCTION" class="headerlink" title="&lt;3&gt; IF FUNCTION"></a>&lt;3&gt; IF FUNCTION</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(grouping(productline),&#39;all productline&#39;, productline)</span><br></pre></td></tr></table></figure>

<p>同样用在<code>select</code>中，<code>if</code>在mysql的作用等同于<code>c</code>中的；</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> flag = grouping(productline)?<span class="number">1</span>:<span class="number">0</span>; <span class="comment">// c中当然没有grouping函数orz</span></span><br><span class="line"><span class="keyword">return</span> (flag==<span class="number">1</span>)?<span class="string">&quot;all product line&quot;</span>:productline;</span><br></pre></td></tr></table></figure>

<h2 id="8-Subquery"><a href="#8-Subquery" class="headerlink" title="8 Subquery"></a>8 Subquery</h2><blockquote>
<p>即在选择的列中再进行一次子集的查询。</p>
<p>集合中表示即query为父集合，subquery为其中的子集</p>
<p>通常通过where来调用</p>
</blockquote>
<p>关系上表示为：<code>outer query&#123;inner query/subquery&#125;</code></p>
<h3 id="8-1-concept"><a href="#8-1-concept" class="headerlink" title="8.1 concept"></a>8.1 concept</h3><p>假设要选取在usa工作的职员：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">concat_ws(&#39;,&#39;,lastname,firstname) </span><br><span class="line">from employees </span><br><span class="line">where officecode in( </span><br><span class="line">select officecode  </span><br><span class="line">from offices where country&#x3D;&#39;USA&#39;);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>注意在in的后面为小括号：</strong><code>(</code></li>
</ul>
<p><strong>DEMO：</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210222145641070.png" alt="image-20210222145641070" style="zoom:50%;" />

<p>这个的关系为：</p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210222145722645.png" alt="image-20210222145722645" style="zoom:50%;" />

<p><strong>注意到因为选取的subquery，因此在in的部分select的行应于query的where相等</strong></p>
<h3 id="8-2-with-comparison-operators"><a href="#8-2-with-comparison-operators" class="headerlink" title="8.2 with comparison operators"></a>8.2 with comparison operators</h3><h4 id="lt-1-gt-choose-the-max-expenditure"><a href="#lt-1-gt-choose-the-max-expenditure" class="headerlink" title="&lt;1&gt; choose the max expenditure"></a>&lt;1&gt; choose the max expenditure</h4><blockquote>
<p>以<code>payments</code>作为demo的表表～</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">customerNumber, checkNUmber, amount </span><br><span class="line">from payments </span><br><span class="line">where amount &#x3D; (select max(amount) from payments);</span><br></pre></td></tr></table></figure>

<p>得到最大消费的客户：</p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210222150534594.png" alt="image-20210222150534594" style="zoom:50%;" />

<h4 id="lt-2-gt-choose-customers-whose-cost-over-avg"><a href="#lt-2-gt-choose-customers-whose-cost-over-avg" class="headerlink" title="&lt;2&gt; choose customers whose cost over avg"></a>&lt;2&gt; choose customers whose cost over avg</h4><blockquote>
<p>在这里把程序变得更实用一些，餐馆一般会重点关注消费大于平均的顾客</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select</span><br><span class="line">    -&gt; customernumber,</span><br><span class="line">    -&gt; paymentdate as date,</span><br><span class="line">    -&gt; amount</span><br><span class="line">    -&gt; from payments</span><br><span class="line">    -&gt; where </span><br><span class="line">    -&gt; amount &gt; (select avg(amount) from payments);</span><br></pre></td></tr></table></figure>

<p>在这里<code>avg</code>会自动计算出该列所有数的平均数:(节选)</p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210222151115502.png" alt="image-20210222151115502" style="zoom:50%;" />

<h3 id="8-3-in-amp-not-in"><a href="#8-3-in-amp-not-in" class="headerlink" title="8.3 in &amp; not in"></a>8.3 in &amp; not in</h3><blockquote>
<p>举个栗子：餐馆可以用来检验会员名单中该会员有没有消费</p>
</blockquote>
<p>在给出的示例数据库中<code>customers</code>为会员名单，<code>orders</code>记录了详细的消费记录，查阅<code>orders</code>来查看会员是否消费</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select</span><br><span class="line">    -&gt; customernumber,</span><br><span class="line">    -&gt; customername</span><br><span class="line">    -&gt; from customers</span><br><span class="line">    -&gt; where customername in (</span><br><span class="line">    -&gt; select customername from orders);</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>in</code>后半部分可以看作customername的子集，选取出的为这两个集合的交集部分</p>
</blockquote>
<p>同样的，<code>not in</code>则是选取集合$A\overline{B}$</p>
<p>试试<code>not in</code>，会发现只要是会员都消费过hhh，所以not in得到的为空集</p>
<h3 id="8-4-subquery-in-from-clause"><a href="#8-4-subquery-in-from-clause" class="headerlink" title="8.4 subquery in from clause"></a>8.4 subquery in from clause</h3><blockquote>
<p>from 里面就是我们合并的表</p>
</blockquote>
<p>在筛选数据时，也常用<code>floor()</code>来处理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; floor(27.75);</span><br><span class="line">mysql&gt; floor(27);</span><br></pre></td></tr></table></figure>

<p>第一个用来筛选数据小于等于<code>27.75</code>的整数，第二个用来筛选数据小于等于<code>27</code>的整数</p>
<p>关于<code>subquery in from clause</code>，我们来举个栗子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select </span><br><span class="line">    -&gt; max(items),</span><br><span class="line">    -&gt; min(items),</span><br><span class="line">    -&gt; floor(avg(items))</span><br><span class="line">    -&gt; from (select ordernumber,</span><br><span class="line">    -&gt; count(ordernumber) as items</span><br><span class="line">    -&gt; from orderdetails</span><br><span class="line">    -&gt; group by ordernumber) </span><br><span class="line">    -&gt; as chosenOrder;</span><br></pre></td></tr></table></figure>

<p><font color=red><strong>⚠️ATTENTIONS:</strong></font></p>
<blockquote>
<p>都是关于<code>subquery from</code>的～</p>
</blockquote>
<ul>
<li>这里<code>select ordernumber</code>是作为<code>group by</code>的顺序的，因为在一个表格中数据的排布需要按照一定的规律，所以一定需要有个<code>group by</code>用来帮助排序表</li>
<li>在这里的<code>subquery from clause</code>中，我们在合并表以后还需要重新命名<code>as chosenOrder</code>，原因是你想啊，我们在原来的<code>from</code>中是对特定表的，这里的<code>as ...</code>就是让这个合并表作为特定表出现哒</li>
</ul>
<blockquote>
<p>专业称为：<code>derived table</code></p>
</blockquote>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210222155707274.png" alt="image-20210222155707274" style="zoom:50%;" />

<p><strong>规范示例：</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210222170049391.png" alt="image-20210222170049391" style="zoom:40%;" />

<h3 id="8-5-correlated-subquery"><a href="#8-5-correlated-subquery" class="headerlink" title="8.5 correlated subquery"></a>8.5 correlated subquery</h3><blockquote>
<p>Correlated: 相关联的</p>
</blockquote>
<p>可以注意到之前的subquery都是可以作为独立表来操作的，即单独使用也可以。而<code>outer query</code> 表择取了<code>subquery</code>中的数据。</p>
<p>而<code>correlated subquery</code>则是取<code>outer query</code>的数据来选取其中的值</p>
<blockquote>
<p>示例用来选取在一个生产线上的明星产品（即buyprice高于同车间其余产品）</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select</span><br><span class="line">    -&gt; productname,</span><br><span class="line">    -&gt; buyprice</span><br><span class="line">    -&gt; from products p</span><br><span class="line">    -&gt; where buyprice &gt; (select avg(buyprice)</span><br><span class="line">    -&gt; from products where productline &#x3D; p.productline);</span><br></pre></td></tr></table></figure>

<ul>
<li>因此在比较的时候选取了where：<code>productline = p.productline</code></li>
</ul>
<p><strong>DEMO:(A LITTLE PART)</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210222163017512.png" alt="image-20210222163017512" style="zoom:50%;" />

<h3 id="8-6-exists-amp-not-exists"><a href="#8-6-exists-amp-not-exists" class="headerlink" title="8.6 exists &amp; not exists"></a>8.6 exists &amp; not exists</h3><blockquote>
<p>类似于having,这里使用orders&amp;orderdetails</p>
</blockquote>
<p>假如我们检验的为哪一个ordernumber的总额大于60k「使用having」</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select ordernumber,</span><br><span class="line">    -&gt; sum(quantityordered * priceeach) as total</span><br><span class="line">    -&gt; from orderdetails </span><br><span class="line">    -&gt; inner join orders using(ordernumber)</span><br><span class="line">    -&gt; group by ordernumber</span><br><span class="line">    -&gt; having total&gt;60000;</span><br></pre></td></tr></table></figure>

<p><strong>DEMO:</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210222163951483.png" alt="image-20210222163951483" style="zoom:50%;" />

<p><font color=red><strong>在alias后可以直接使用aliasName</strong></font></p>
<ul>
<li>using exists to find rich man ovo</li>
</ul>
<blockquote>
<p>通过subquery来找到消费过60k的顾客</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">customernumber, customername from customers c </span><br><span class="line">where Exists( select ordernumber, </span><br><span class="line">sum(quantityordered * priceeach) as total </span><br><span class="line">from orderdetails </span><br><span class="line">inner join orders using(ordernumber) </span><br><span class="line">where customernumber&#x3D;c.customernumber </span><br><span class="line">group by ordernumber</span><br><span class="line">having total &gt; 60000);</span><br></pre></td></tr></table></figure>

<p>表间关系为：<br>$$<br>orderdetails \Longleftrightarrow orders \Longrightarrow customers<br>$$<br><strong>DEMO:</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210222165750632.png" alt="image-20210222165750632" style="zoom:50%;" />

<ul>
<li>当使用了<code>join</code>后，意味着该表也参与了建表中，可以使用引用表内的参数的～</li>
</ul>
<h3 id="8-7-complex-derived-subquery"><a href="#8-7-complex-derived-subquery" class="headerlink" title="8.7 complex derived subquery"></a>8.7 complex derived subquery</h3><blockquote>
<p>Round(numeric value, INTEGER): 表示将数值规范到小数点后<code>INTEGER</code>位</p>
</blockquote>
<ul>
<li>case的用法：</li>
</ul>
<blockquote>
<p>跟switch的分类效果相同</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CASE</span><br><span class="line">    WHEN condition1 THEN result1</span><br><span class="line">    WHEN condition2 THEN result2</span><br><span class="line">    WHEN conditionN THEN resultN</span><br><span class="line">    ELSE result</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>

<p>示例：2003年不同产业的营业额的分类，通过customer的orderdetail判断customer的产业</p>
<p>分类为：<br>$$<br>\left{<br>\begin{aligned}<br>&amp;Platinum,  &amp;&gt;100K \<br>&amp;Gold, &amp;(10K,100K) \<br>&amp;Sliver, &amp;&lt;10K</p>
<p>\end{aligned}<br>\right.<br>$$</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">customernumber, </span><br><span class="line">round(sum(priceeach * quantityordered)) as sales, </span><br><span class="line">(case </span><br><span class="line">when sum(priceeach * quantityordered) &gt; 100000 then &#39;platinum&#39; </span><br><span class="line">when sum(priceeach * quantityordered) between 10000 and 100000 then &#39;gold&#39; </span><br><span class="line">when sum(priceeach * quantityordered) &lt; 10000 then &#39;sliver&#39; </span><br><span class="line">end) salesgroup </span><br><span class="line">from orderdetails </span><br><span class="line">	inner join orders using(ordernumber) </span><br><span class="line">	where year(orderdate)&#x3D;2003 </span><br><span class="line">group by customernumber;</span><br></pre></td></tr></table></figure>

<ul>
<li>在select中进行分类时需要用<code>(case ... end)</code>包括起来</li>
<li>使用sum时注意不要留空格</li>
</ul>
<p>之后我们能够通过这个分类的子表来获取各个行业的个数～</p>
<blockquote>
<p>这块就不展示了，懒癌晚期</p>
</blockquote>
<blockquote>
<p>作为第二天的复习，我又写了</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select </span><br><span class="line">    -&gt; customerGroup,</span><br><span class="line">    -&gt; count(cg.customerGroup) as groupCount</span><br><span class="line">    -&gt; from (select </span><br><span class="line">    -&gt; customernumber,</span><br><span class="line">    -&gt; round(sum(quantityordered * priceeach)) as sales,</span><br><span class="line">    -&gt; (case </span><br><span class="line">    -&gt; when sum(quantityordered * priceeach)&gt;100000 the &#39;platinum&#39;</span><br><span class="line">    -&gt; when sum(quantityordered * priceeach) between 10000 and 100000 then &#39;gold&#39;;</span><br><span class="line">    -&gt; when sum(quantityordered * priceeach)&lt;10000 then &#39;sliver&#39;</span><br><span class="line">    -&gt; end) customerGroup</span><br><span class="line">    -&gt; from orders inner join orderdetails using(ordernumber)</span><br><span class="line">    -&gt; where year(shippeddate)&#x3D;2003</span><br><span class="line">    -&gt; group by customernumber) as cg</span><br><span class="line">    -&gt; group by cg.customerGroup;</span><br></pre></td></tr></table></figure>

<ul>
<li>注意：既然使用了<code>cg.customergroup</code>就需要在<code>subquery</code>中为<code>customerGroup</code>别名</li>
</ul>
<p><strong>Final Demo:</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210223133502097.png" alt="image-20210223133502097" style="zoom:50%;" />

<p><font color=green><strong>mysql 8.0+ 有新添的功能为：<code>mysql CTE</code></strong></font>,但是因为我的还没有更新到<code>8.0+</code>在这里就没有讨论这一块了，我后面会补上的，不咕咕！</p>
<h2 id="9-Union"><a href="#9-Union" class="headerlink" title="9 Union"></a>9 Union</h2><blockquote>
<p>union将两列及以上的多列合并成一列</p>
</blockquote>
<p>在使用<code>union</code>时一定要遵循两个规定：</p>
<ul>
<li>在<code>select</code>中出现的列的列数和列顺序一定要相同</li>
<li><code>union</code>的列中的数据类型必须相同</li>
</ul>
<blockquote>
<p><code>union</code>默认去除相同的行，保留不同的属性，省去了<code>distinct</code>的要求</p>
</blockquote>
<h3 id="9-1-simple-use"><a href="#9-1-simple-use" class="headerlink" title="9.1 simple use"></a>9.1 simple use</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists t1;</span><br><span class="line">drop table if exists t2;</span><br><span class="line"></span><br><span class="line">create table t1(</span><br><span class="line">	id int primary key</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">create table t2(</span><br><span class="line">	id int primary key</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">insert into t1 values (1),(3),(4);</span><br><span class="line">insert into t2 values (1),(2),(3),(4);</span><br></pre></td></tr></table></figure>

<p>合并<code>t1</code>和<code>t2</code>得到：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select id</span><br><span class="line">from t1</span><br><span class="line">union</span><br><span class="line">select id</span><br><span class="line">from t2;</span><br></pre></td></tr></table></figure>

<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210223140510814.png" alt="image-20210223140510814" style="zoom:50%;" />

<blockquote>
<p>由<code>t1</code>的<code>1，3，4</code>都存在，到之后的<code>t2</code>只能加入<code>2</code>，后得到<code>union</code>的表格</p>
</blockquote>
<p>如果希望得到两个集合合并的全部元素：</p>
<p>将<code>union</code>修改为<code>union all</code>:</p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210223140853055.png" alt="image-20210223140853055" style="zoom:50%;" />

<p>可能出错的地方：</p>
<ul>
<li><code>insert into</code> 的为<code>values</code>，并且后面的<code>values</code>需要用<code>()</code>包含并以<code>,</code>分割开来</li>
<li>建表时注意规定<code>primary key</code></li>
</ul>
<h3 id="9-2-comparison-with-join"><a href="#9-2-comparison-with-join" class="headerlink" title="9.2 comparison with join"></a>9.2 comparison with join</h3><blockquote>
<p>会发现union和join一样都有集合合并的意味，那么他们的区别是什么呢？</p>
</blockquote>
<p>无论是<code>inner join</code>还是<code>right/left join</code>，都会以一个原表的结构呈现出来，对于<code>join</code>，它的表是水平扩展的；而对于<code>union</code>，则是垂直扩展的，举个栗子：</p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210223141827968.png" alt="image-20210223141827968" style="zoom:50%;" />

<h3 id="9-3-applications"><a href="#9-3-applications" class="headerlink" title="9.3 applications"></a>9.3 applications</h3><p>实际应用于：假如在销售时希望查找客户的明星经理，可以通过union来筛选人气最高的经理</p>
<blockquote>
<p>选取<code>employees</code>表和<code>customers</code>表来完成</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select lastName,firstName</span><br><span class="line">    -&gt; from employees</span><br><span class="line">    -&gt; union</span><br><span class="line">    -&gt; select contactlastname,contactfirstname</span><br><span class="line">    -&gt; from customers;</span><br></pre></td></tr></table></figure>

<p><strong>Demo：A LITTLE PART</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210223143032404.png" alt="image-20210223143032404" style="zoom:50%;" />

<h3 id="9-4-Additonal-part"><a href="#9-4-Additonal-part" class="headerlink" title="9.4 Additonal part"></a>9.4 Additonal part</h3><ul>
<li>加入新列<code>contactPerson</code>来表示<code>contactPerson</code>为<code>Employees</code>or<code>Customers</code></li>
<li>将全名表示出来，使用<code>employees</code>中<code>lastname</code>及·<code>customers</code>中<code>contactlastname</code></li>
</ul>
<blockquote>
<p>union后需要排列的话需要通过<code>order by</code>（我一直以为<code>group by</code>能排序来着，事实是它是用来合并相同<code>row</code>的orz…）</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select concat_ws(&#39;,&#39;, lastname, firstname) as name,</span><br><span class="line">    -&gt; &#39;Employee&#39; as contactPerson</span><br><span class="line">    -&gt; from employees </span><br><span class="line">    -&gt; union select concat_ws(&#39;,&#39;, contactlastname, contactfirstname) as name, </span><br><span class="line">    -&gt; &#39;Customer&#39; as contactPerson</span><br><span class="line">    -&gt; from customers</span><br><span class="line">    -&gt; order by name;</span><br></pre></td></tr></table></figure>

<p><strong>Demo: SUBPART</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210223145224744.png" alt="image-20210223145224744" style="zoom:50%;" />

<blockquote>
<p>在sql的union中还有还有<code>minus</code>和<code>intersect</code>两种语法，在mysql中没有这两种特性，但是可以通过已有的mysql语法，如<code>join</code>,<code>distinct</code>,<code>in</code>等方法来模仿这两个功能。（这个坑之后再补qwq）</p>
</blockquote>
<h2 id="10-Modifing-data"><a href="#10-Modifing-data" class="headerlink" title="10 Modifing data"></a>10 Modifing data</h2><h3 id="10-1-insert"><a href="#10-1-insert" class="headerlink" title="10.1 insert"></a>10.1 insert</h3><p><strong>通用模型：</strong></p>
<ul>
<li><code>single row</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert into table_name(c1, c2,..., cn)</span><br><span class="line">values(v1, v2, v3)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>multiple rows</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">insert into table_name(c1, c2, ...)</span><br><span class="line">values (v1, v2, v3),</span><br><span class="line">(v1, v2, v3),</span><br><span class="line">...,</span><br><span class="line">(v1, v2, v3);</span><br></pre></td></tr></table></figure>

<p>建一个表作为例子来说明</p>
<h4 id="10-1-1-insert-example"><a href="#10-1-1-insert-example" class="headerlink" title="10.1.1 insert example"></a>10.1.1 insert example</h4><ol>
<li><strong>建表</strong></li>
</ol>
<p>建立关于<code>tasks</code>的表格：</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Data structure</th>
</tr>
</thead>
<tbody><tr>
<td>Task_id</td>
<td>Int「auto_increment」</td>
</tr>
<tr>
<td>title</td>
<td>varchar(255) not null</td>
</tr>
<tr>
<td>Start_date</td>
<td>Date</td>
</tr>
<tr>
<td>End_date</td>
<td>date</td>
</tr>
<tr>
<td>Priority</td>
<td>Tinyint</td>
</tr>
<tr>
<td>description</td>
<td>Text</td>
</tr>
<tr>
<td>Primary key</td>
<td>Task_id</td>
</tr>
</tbody></table>
<blockquote>
<p>基于上述关系建立表格：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table if not exists tasks(</span><br><span class="line">    -&gt; task_id int auto_increment,</span><br><span class="line">    -&gt; title varchar(255) not null,</span><br><span class="line">    -&gt; start_date date,</span><br><span class="line">    -&gt; end_date date,</span><br><span class="line">    -&gt; priority tinyint not null default 3,</span><br><span class="line">    -&gt; description text,</span><br><span class="line">    -&gt; primary key(task_id));</span><br></pre></td></tr></table></figure>

<h4 id="10-1-2-simple-example"><a href="#10-1-2-simple-example" class="headerlink" title="10.1.2 simple example"></a>10.1.2 simple example</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert into tasks(title, task_id)</span><br><span class="line">values(&#39;this is the 1st example&#39;, 1);</span><br></pre></td></tr></table></figure>

<ul>
<li>当在insert语句中没有定义数据类型时，默认为null</li>
<li><code>not null</code>意味着如果你没有输入相应数据，会返回错误信息</li>
<li>对于<code>primary key</code>的属性，如果是有序列表，一般在数据类型后加<code>auto_increment</code>来达到自增效果</li>
</ul>
<p><strong>DEMO:</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210224151755390.png" alt="image-20210224151755390" style="zoom:50%;" />

<h4 id="10-1-2-LET-IT-BE-COMPLEX"><a href="#10-1-2-LET-IT-BE-COMPLEX" class="headerlink" title="10.1.2 LET IT BE COMPLEX!"></a>10.1.2 LET IT BE COMPLEX!</h4><h5 id="lt-1-gt-use-default-value"><a href="#lt-1-gt-use-default-value" class="headerlink" title="&lt;1&gt; use default value"></a>&lt;1&gt; use default value</h5><p>使用默认值一般有两种方式：</p>
<ul>
<li>在一开始建表时，使用insert中定义了该默认值后，insert into时不用为该属性赋值</li>
<li>在insert into中对于插入的列使用关键字<code>default</code>来插入默认值</li>
</ul>
<blockquote>
<p>以priority的default值为例</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into tasks(title, priority)</span><br><span class="line">    -&gt; values(&#39;this is the 2nd example&#39;, default);</span><br></pre></td></tr></table></figure>

<p><strong>Demo:</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210224152425137.png" alt="image-20210224152425137" style="zoom:50%;" />

<blockquote>
<p>如果之后需要确认什么值没有修改时，可以规定default为常用纠错值</p>
</blockquote>
<hr>
<h5 id="lt-2-gt-insert-specified-date"><a href="#lt-2-gt-insert-specified-date" class="headerlink" title="&lt;2&gt; insert specified date"></a>&lt;2&gt; insert specified date</h5><blockquote>
<p>插入具体的时间时，一般采用国际标准格式：</p>
<p>‘YYYY-MM-DD’: 2021-02-24</p>
</blockquote>
<p>又到了举例子的时候了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into tasks(title, start_date, end_date)</span><br><span class="line">    -&gt; values(&#39;this is the 3rd example&#39;, &#39;2021-02-24&#39;, &#39;2021-03-06&#39;);</span><br></pre></td></tr></table></figure>

<p>同时，在sql语句中还有许多关于时间的具有返回值的函数，也是可以调用过来使用的</p>
<p>相关的时间函数在这里面有：<a target="_blank" rel="noopener" href="https://www.w3schools.com/sql/func_mysql_current_date.asp">w3school SQL语法</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">% 这里我只用current_date来举例了</span><br><span class="line">mysql&gt; insert into tasks(title, start_date, end_date)</span><br><span class="line">    -&gt; values(&#39;this is the 4th example&#39;, current_date(), current_date());</span><br></pre></td></tr></table></figure>

<p><strong>DEMO: two parts</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210224153357716.png" alt="image-20210224153357716" style="zoom:50%;" />

<hr>
<h5 id="lt-3-gt-insert-mutiple-rows"><a href="#lt-3-gt-insert-mutiple-rows" class="headerlink" title="&lt;3&gt; insert mutiple rows"></a>&lt;3&gt; insert mutiple rows</h5><blockquote>
<p>多次处理，一次到位hhh</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into tasks(title, priority)</span><br><span class="line">    -&gt; values </span><br><span class="line">    -&gt; (&#39;multi 1st&#39;, 1),</span><br><span class="line">    -&gt; (&#39;multi 2nd&#39;, 2),</span><br><span class="line">    -&gt; (&#39;multi 3rd&#39;, 3);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>注意：</strong>即使插入了多行，<code>values</code>也只需要在一开始的时候说明即可</li>
<li><code>row</code>间以<code>,</code>分割开来</li>
</ul>
<h4 id="10-1-3-use-remained-db-to-insert"><a href="#10-1-3-use-remained-db-to-insert" class="headerlink" title="10.1.3 use remained db to insert"></a>10.1.3 use remained db to insert</h4><p><strong>General usage:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">insert into table_name(column_list)</span><br><span class="line">select column_list_add</span><br><span class="line">from table_name</span><br><span class="line">where add_condition;</span><br></pre></td></tr></table></figure>

<p>这种用法称为<code>insert into insert</code>，一般用于抽取特定的数据</p>
<p>假设我们现在抽取关于<code>customers</code>在<code>NY NYC</code>的全部顾客，使用原有数据库中的<code>customers</code>表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">% 建立表格</span><br><span class="line">mysql&gt; create table if not exists primeCustomers(</span><br><span class="line">    -&gt; customernumber int,</span><br><span class="line">    -&gt; customername varchar(255),</span><br><span class="line">    -&gt; contactlastname varchar(255),</span><br><span class="line">    -&gt; contactfirstname varchar(255),</span><br><span class="line">    -&gt; phone varchar(255),</span><br><span class="line">    -&gt; addressline1 varchar(255),</span><br><span class="line">    -&gt; addressline2 varchar(255),</span><br><span class="line">    -&gt; city varchar(55),</span><br><span class="line">    -&gt; state varchar(55));</span><br></pre></td></tr></table></figure>

<p>现在<code>copy data</code>粘贴到这个表中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into primeCustomers select customernumber, customername, contactlastname, contactfirstname, phone, addressline1,</span><br><span class="line">    -&gt; addressline2,</span><br><span class="line">    -&gt; city,</span><br><span class="line">    -&gt; state</span><br><span class="line">    -&gt; from customers</span><br><span class="line">    -&gt; where city&#x3D;&#39;NYC&#39; and state&#x3D;&#39;NY&#39;;</span><br></pre></td></tr></table></figure>

<p><strong>DEMO:</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210224155946187.png" alt="image-20210224155946187" style="zoom:50%;" />

<hr>
<p> <font color=green><center>进化版！</center></font></p>
<p>假设现在建立关于统计数据表格，需要统计的数据为：<code>totalproduct</code>,<code>totalcustomer</code>,<code>totalorder</code>.</p>
<p>从这三个表中获取数据：<code>products</code>, <code>customers</code>, <code>orders</code>放到<code>statistics</code>表中</p>
<ol>
<li><strong>create statistics table</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table if not exists statistics(</span><br><span class="line">    -&gt; totalproduct int,</span><br><span class="line">    -&gt; totalcustomer int,</span><br><span class="line">    -&gt; totalorder int);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>insert relative datas</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into statistics </span><br><span class="line">    -&gt; values(</span><br><span class="line">    -&gt; (select count(*) from products),</span><br><span class="line">    -&gt; (select count(*) from customers),</span><br><span class="line">    -&gt; (select count(*) from orders));</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>Final result</strong></li>
</ol>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210224161249474.png" alt="image-20210224161249474" style="zoom:50%;" />

<h4 id="10-1-4-insert-「on-duplicate-keys-update」"><a href="#10-1-4-insert-「on-duplicate-keys-update」" class="headerlink" title="10.1.4 insert 「on duplicate keys update」"></a>10.1.4 insert 「on duplicate keys update」</h4><blockquote>
<p>这是mysql在sql上的扩展，sql在insert into duplicate rows会返回错误消息</p>
</blockquote>
<p>错误消息在mysql中可以通过insert on duplicate keys update来进行更正或更新</p>
<p><strong>general structure</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">insert into table(c1)</span><br><span class="line">values(c1) </span><br><span class="line">on duplicate keys update c1 &#x3D; values(c1)+1;</span><br></pre></td></tr></table></figure>

<hr>
<center>全流程</center>

<ol>
<li><strong>create demo table devices</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table if not exists devices(</span><br><span class="line">    -&gt; id int auto_increment key,</span><br><span class="line">    -&gt; name varchar(255));</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>insert initial values</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into devices(name) values(&#39;haha&#39;),(&#39;gugu&#39;),(&#39;mumu&#39;);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>try to change duplicated value if it does</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">your MySQL server version for the right syntax to use near &#39;keys update name&#x3D;&#39;kiki&#39;&#39; at line 1</span><br><span class="line">mysql&gt; insert into devices(name)</span><br><span class="line">    -&gt; values(&#39;kuku&#39;)</span><br><span class="line">    -&gt; on duplicate key update name&#x3D;&#39;kuku&#39;;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>the changed「1st」 condition</strong></li>
</ol>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210224164718151.png" alt="image-20210224164718151" style="zoom:50%;" />

<ol start="5">
<li>Add specified value by using duplicate demand</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into devices(name)</span><br><span class="line">    -&gt; values(&#39;this is changed name&#39;) </span><br><span class="line">    -&gt; on duplicate key update name&#x3D;&#39;kuku&#39;;</span><br></pre></td></tr></table></figure>

<p><strong>final result:</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210224165015640.png" alt="image-20210224165015640" style="zoom:50%;" />

<ul>
<li><font color=red><strong>注意更新值时的指令顺序：是对重复值，因此为：</strong></font> <code>on duplicate key update</code></li>
<li>对于<code>duplicate values</code>， <code>mysql</code>采取的方式抽象理解为：打不过就改个名字加入他们</li>
</ul>
<hr>
<h4 id="10-1-5-insert-ignore"><a href="#10-1-5-insert-ignore" class="headerlink" title="10.1.5 insert ignore"></a>10.1.5 insert ignore</h4><blockquote>
<p>同样为mysql关于sql的扩展</p>
</blockquote>
<p>这个方法用于处理当在一个process中，即使插入了$invalid\ value$，进程也不受影响，继续执行insert $valid\ value$.</p>
<p><strong>general structure</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">insert ignore table_name(c1, c2, ...)</span><br><span class="line">values</span><br><span class="line">(c1, c2, ...),</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>举个栗子：「当没有使用<code>on duplicate ...</code>时，插入<code>duplicate key</code>是会返回错误消息的」</p>
<blockquote>
<p>秉承不浪费的原则，在devices表上进行修改</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into devices(id) </span><br><span class="line">    -&gt; values(1);</span><br></pre></td></tr></table></figure>

<ul>
<li>不能重复的在表中仅有<code>key</code>值「毕竟<code>key</code>值唯一鸭」</li>
</ul>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210224170612984.png" alt="image-20210224170612984" style="zoom:50%;" />

<p>出现duplicate value，错误</p>
<ul>
<li><strong>忽略该错误</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert ignore into devices(id) values(1);</span><br></pre></td></tr></table></figure>

<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210224170807541.png" alt="image-20210224170807541" style="zoom:50%;" />

<p>只有warning啦</p>
<h5 id="appendix：-ignore-v-s-strict-mode"><a href="#appendix：-ignore-v-s-strict-mode" class="headerlink" title="appendix： ignore v.s strict mode"></a>appendix： ignore v.s strict mode</h5><p>在一般情况下，如果insert出错，毫无疑问的返回<code>error</code>;但是如果选用<code>ignore</code>，插入虽然失败，但还是会在原本要插入的属性当中，插入的为正确的部分。继续举🌰：</p>
<hr>
<ol>
<li><strong>再次create新表</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table if not exists strictTry( name varchar(5) key);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>试图插入invalid value</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into strictTry(name)</span><br><span class="line">    -&gt; values(&#39;hahahahaha&#39;);</span><br></pre></td></tr></table></figure>

<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210224171905449.png" alt="image-20210224171905449" style="zoom:50%;" />

<ol start="3">
<li><strong>试试ignore</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert ignore into strictTry(name)</span><br><span class="line">    -&gt; values(&#39;hahahahaha&#39;);</span><br></pre></td></tr></table></figure>

<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210224171954842.png" alt="image-20210224171954842" style="zoom:50%;" />

<hr>
<h3 id="10-2-Update"><a href="#10-2-Update" class="headerlink" title="10.2 Update"></a>10.2 Update</h3><blockquote>
<p>在mysql中，更新数据是十分重要滴！</p>
</blockquote>
<h4 id="10-2-1-simple-update"><a href="#10-2-1-simple-update" class="headerlink" title="10.2.1 simple update"></a>10.2.1 simple update</h4><p><code>Update</code>语句允许操作一列或多列。</p>
<p><strong>general structure:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">update [low_priority][ignore] table_name</span><br><span class="line">set</span><br><span class="line">	column_name &#x3D; expr1,</span><br><span class="line">	column_name &#x3D; expr2,</span><br><span class="line">	...</span><br><span class="line">[where</span><br><span class="line">	condition]</span><br></pre></td></tr></table></figure>

<ul>
<li>注意<code>where</code>的条件，如果不限定修改行，会对选取列的值全部修改</li>
</ul>
<p>在<code>update</code>中支持两类<strong>modifiers</strong>「修饰语」</p>
<ul>
<li><code>LOW_PRIORITY:</code> 在这类情况下，表将会延迟update直到其他表停止从该表读取数据</li>
<li><code>ignore:</code> 跟上述的<code>ignore</code>的作用相同，即表在update的过程中即使遇到小的错误也能继续完成操作</li>
</ul>
<p>假设我们现在要修改<code>employees</code>表内关于顾客<code>mary patterson</code>的预留邮箱为：<code>mary.patterso@classicmodelcars.com</code></p>
<p>先查看她原先的邮箱：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select </span><br><span class="line">    -&gt; lastname, firstname, email</span><br><span class="line">    -&gt; from employees</span><br><span class="line">    -&gt; where employeenumber&#x3D;1056;</span><br></pre></td></tr></table></figure>

<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210225154326872.png" alt="image-20210225154326872" style="zoom:50%;" />

<p><strong>update it！</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update employees</span><br><span class="line">    -&gt; set email &#x3D; &#39;mary.patterso@classicmodelcars.com&#39;</span><br><span class="line">    -&gt; where employeenumber&#x3D;1056;</span><br></pre></td></tr></table></figure>

<p><strong>修改后：</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210225154601813.png" alt="image-20210225154601813" style="zoom:50%;" />

<p>同时修改一行中多个信息，在<code>set</code>当中设置即可，但是记得用<code>where</code>来标记特殊</p>
<h4 id="10-2-2-use-replace-to-change-info"><a href="#10-2-2-use-replace-to-change-info" class="headerlink" title="10.2.2 use replace to change info"></a>10.2.2 use replace to change info</h4><hr>
<center><b>REPLACE()</b></center>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replace(src, sub_src, change_src)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>src:</code></strong> 源字符串</li>
<li>**<code>subsrc:</code>**源字符串的子串</li>
<li><strong><code>change_src:</code></strong> 修改后的子串</li>
</ul>
<hr>
<p>假如现在6号办公室的所有<code>sales rep</code>搬到了<code>@mysqlexample.com</code>的公司页面，将他们进行全部修改有：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update employees</span><br><span class="line">    -&gt; set email&#x3D;replace(email, &#39;classicmodelcars&#39;, &#39;mysqlexample&#39;)</span><br><span class="line">    -&gt; where jobtitle&#x3D;&#39;sales rep&#39; and officecode&#x3D;6;</span><br></pre></td></tr></table></figure>

<p><strong>修改后：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select officecode,</span><br><span class="line">    -&gt; jobtitle,</span><br><span class="line">    -&gt; email</span><br><span class="line">    -&gt; from employees</span><br><span class="line">    -&gt; where jobtitle&#x3D;&#39;sales rep&#39; and officecode&#x3D;6;</span><br></pre></td></tr></table></figure>

<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210225160514245.png" alt="image-20210225160514245" style="zoom:50%;" />

<h4 id="10-2-3-combine-subquery-with-update-value"><a href="#10-2-3-combine-subquery-with-update-value" class="headerlink" title="10.2.3 combine subquery with update value"></a>10.2.3 combine subquery with update value</h4><p>挑选<code>customers</code>中<code>salesemployeenumber=null</code>的顾客：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select customernumber,</span><br><span class="line">    -&gt; customername,</span><br><span class="line">    -&gt; salesrepemployeenumber</span><br><span class="line">    -&gt; from customers</span><br><span class="line">    -&gt; where salesrepemployeenumber is null;</span><br></pre></td></tr></table></figure>

<ul>
<li>在挑选值为null的时候，不能直接<code>=</code>，而是应该用<code>is</code>来判断<strong>「debug了好久qwq」</strong></li>
</ul>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210225161535548.png" alt="image-20210225161535548" style="zoom:50%;" />

<p><strong>update them！</strong></p>
<p>为了使赋值具有随机抽样的特性，我们引入rand函数，修改方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update customers</span><br><span class="line">    -&gt; set salesrepemployeenumber&#x3D;(select</span><br><span class="line">    -&gt; employeenumber</span><br><span class="line">    -&gt; from employees</span><br><span class="line">    -&gt; where jobtitle&#x3D;&#39;sales rep&#39;</span><br><span class="line">    -&gt; order by rand()</span><br><span class="line">    -&gt; limit 1)</span><br><span class="line">    -&gt; where salesrepemployeenumber is null;</span><br></pre></td></tr></table></figure>

<p>这个时候再查找为null的rows，则会返回<code>empty set</code>：</p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210225162222737.png" alt="image-20210225162222737" style="zoom:50%;" />

<h4 id="10-2-4-update-with-join"><a href="#10-2-4-update-with-join" class="headerlink" title="10.2.4 update with join"></a>10.2.4 update with join</h4><p>在我们希望能将另外一张表的属性迁移到另一张表时，可以找到两张表的公共属性后，再修改不同的属性。</p>
<p>以表<code>T1,T2</code>为例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">update t1, t2</span><br><span class="line">[inner join| left join] t1 on t1.c1&#x3D;t2.c1</span><br><span class="line">set t1.c2 &#x3D; t2.c2</span><br><span class="line">		t2.c3 &#x3D; expr</span><br><span class="line">where condition</span><br></pre></td></tr></table></figure>

<p><strong>Details：</strong></p>
<ul>
<li>确定主表，即在join时需要保留的数据主要源于何表</li>
<li>通过where限定修改的rows</li>
</ul>
<hr>
<p><strong>Goal：</strong> 建立<code>empdb</code>数据库来计算该年份雇员的薪资，其中<code>employees</code>表记录<code>emp_id</code>,<code>name</code>,<code>performance</code> and <code>salary</code>；而<code>merits</code>记录<code>performance</code> and <code>percentage</code></p>
<p><strong>New Usage:</strong></p>
<ol>
<li><code>database</code><ul>
<li><strong><code>foreign key</code></strong>: 作为连接两个表的<code>key</code>，其中有着<code>foreign key</code>的称为子表，其父表称为<code>parent table</code>或<code>referenced table</code>，<code>foreign key</code>的值由其父表<code>parent table</code>中的<code>primary key</code>决定</li>
<li><strong><code>constraints:</code></strong> 用于限定表中的数据类型，一般有<code>foreign key</code>,<code>unique</code>等约束关系</li>
</ul>
</li>
</ol>
<p>开始建立数据库吧！</p>
<hr>
<center><b>merits employees 数据库建立</b></center>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table merits(</span><br><span class="line">    -&gt; performance int(11),</span><br><span class="line">    -&gt; percentage float not null,</span><br><span class="line">    -&gt; primary key (performance)</span><br><span class="line">    -&gt; );</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; cretae table employees(</span><br><span class="line">    -&gt; emp_id int(11) not null auto_increment,</span><br><span class="line">    -&gt; emp_name varchar(255),</span><br><span class="line">    -&gt; performance int(11),</span><br><span class="line">    -&gt; salary float not null,</span><br><span class="line">    -&gt; primary key (emp_id),</span><br><span class="line">    -&gt; constraint fk_performance foreign key(perfoemance) </span><br><span class="line">    -&gt; references merits(performance);</span><br></pre></td></tr></table></figure>

<hr>
<center><b>插入数据</b></center>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into merits(performance, percentage)</span><br><span class="line">    -&gt; values(1,0), (2, 0.01),</span><br><span class="line">    -&gt; (3, 0.03), (4, 0.05), (5, 0.08);</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into employees(emp_name, performance, salary)</span><br><span class="line">    -&gt; values(&#39;gugu&#39;, 1, 10000),</span><br><span class="line">    -&gt; (&#39;tutu&#39;, 3, 3500),</span><br><span class="line">    -&gt; (&#39;bubu&#39;, 5, 8700);</span><br></pre></td></tr></table></figure>

<hr>
<center><b>计算年终</b></center>

<p>$$<br>salary  = salary+salary\times percentage<br>$$</p>
<ul>
<li>原工资：</li>
</ul>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210226095142647.png" alt="image-20210226095142647" style="zoom:50%;" />

<ul>
<li><strong>修改后的工资：</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update employees inner join merits</span><br><span class="line">		-&gt; on employees.performance&#x3D;merits.performance</span><br><span class="line">		-&gt; set salary &#x3D; salary+salary*percentage;</span><br></pre></td></tr></table></figure>

<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210226095342535.png" alt="image-20210226095342535" style="zoom:50%;" />

<hr>
<blockquote>
<p>上面的<code>inner join</code>部分，使用<code>left join</code>试试</p>
</blockquote>
<p>这个情景可以描述为：新员工入工作室，此时的绩效表现为null，但是年终默认给新人的利率为<code>0.015</code>，则有：</p>
<ul>
<li><strong>加入新员工</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into employees(emp_name, performance, salary)</span><br><span class="line">    -&gt; values (&#39;new_colleague1&#39;, null, 3000),</span><br><span class="line">    -&gt; (&#39;new_colleague2&#39;, null, 12000);</span><br></pre></td></tr></table></figure>

<ul>
<li>更新工资</li>
</ul>
<blockquote>
<p>这里使用<code>left join</code>的目的是，当使用<code>merits</code>和<code>employees</code>时，避免因为<code>employees</code>的<code>performance</code>为<code>null</code>，而忽略了处理<code>null</code>值</p>
</blockquote>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210226100812326.png" alt="image-20210226100812326" style="zoom:50%;" />

<p>在<code>update</code>的条件下，可以使用的join方式仅有<code>inner join</code>及<code>left join</code>，根据需求来更新表</p>
<hr>
<h3 id="10-3-Delete"><a href="#10-3-Delete" class="headerlink" title="10.3 Delete"></a>10.3 Delete</h3><p><strong>general sturcture</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">delete from table_name</span><br><span class="line">where condition</span><br></pre></td></tr></table></figure>

<p><strong>TIPS:</strong></p>
<ul>
<li><code>where</code> 【optional】：当不规定情况的时候，默认删除所有数据</li>
<li>删除多表间数据时，有<code>delete join</code>来处理</li>
<li>在不清楚想要删除多少列时，使用<code>truncate table</code>来处理</li>
<li>对于<code>foreign key</code>，如果<code>parent table</code>删除数据后，关于子表有[optional]<code>on  delete cascade</code>的处理方式</li>
</ul>
<h4 id="10-3-1-simple-example"><a href="#10-3-1-simple-example" class="headerlink" title="10.3.1 simple example"></a>10.3.1 simple example</h4><blockquote>
<p>选用的依旧是可爱的<code>employees</code>表ovo</p>
</blockquote>
<p>删除所有<code>officecode=4</code>的雇员吧～</p>
<ul>
<li>原职员</li>
</ul>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210226102058328.png" alt="image-20210226102058328" style="zoom:50%;" />

<ul>
<li>残忍的删除后</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; delete from employees</span><br><span class="line">    -&gt; where officecode&#x3D;4;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>失败了，因为<code>officecode</code>是某个<code>foreign table</code>的<code>foreign key</code></p>
</blockquote>
<p>如果不小心删除了数据，可以通过之后提到的<code>truncate</code>方式来恢复</p>
<hr>
<p>或者试着删除一下居住在法国的信用卡额度最低的前十位顾客~</p>
<ul>
<li><strong>看一下有哪些顾客</strong></li>
</ul>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210226102945886.png" alt="image-20210226102945886" style="zoom:50%;" />

<ul>
<li><strong>删除前十位</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">delete from customers</span><br><span class="line">where country&#x3D;&#39;france&#39;</span><br><span class="line">orderby creditlimit</span><br><span class="line">limit 10;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>删除当然不成功啦hhh，因为会删除<code>parent row</code>对表格造成影响，至于怎么删除，后面会谈</p>
</blockquote>
<hr>
<h4 id="10-3-2-delete-multi-table"><a href="#10-3-2-delete-multi-table" class="headerlink" title="10.3.2 delete multi table"></a>10.3.2 delete multi table</h4><blockquote>
<p>通过<code>delete join</code>的方式删除相关表的共同部分</p>
</blockquote>
<p><strong>general structure:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; delete t1, t2</span><br><span class="line">		-&gt; from t1</span><br><span class="line">		-&gt; inner join t2 on t1.key&#x3D;t2.key</span><br><span class="line">		-&gt; where condition</span><br></pre></td></tr></table></figure>

<p><strong>TIPS</strong></p>
<ul>
<li>当仅删除t1时，即<code>delete t1</code>，结果是删除的为t2所有的相关行；反之亦然</li>
<li>而<code>delete t1, t2</code>则删除的是<code>t1, t2</code>的公共部分</li>
</ul>
<blockquote>
<p>因为classicmodels中的父子表关系比较复杂，因此在empdb里面建表来示例一下吧～</p>
</blockquote>
<hr>
<center><b>建表t1, t2</b></center>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists t1, t2;</span><br><span class="line">mysql&gt; create table t1(</span><br><span class="line">    -&gt; id int auto_increment,</span><br><span class="line">    -&gt; primary key (id));</span><br><span class="line"></span><br><span class="line">mysql&gt; create table t2(</span><br><span class="line">    -&gt; id varchar(5),</span><br><span class="line">    -&gt; ref int not null,</span><br><span class="line">    -&gt; primary key (id));</span><br></pre></td></tr></table></figure>

<center><b>插入数据</b></center>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into t1(id)</span><br><span class="line">    -&gt; values (1),(3),(4);</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into t2(id, ref)</span><br><span class="line">    -&gt; values (1,&#39;A&#39;), (2, &#39;B&#39;), (4, &#39;D&#39;);</span><br></pre></td></tr></table></figure>

<center><b>删除相同索引</b></center>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; delete t1,t2</span><br><span class="line">    -&gt; from t1</span><br><span class="line">    -&gt; inner join t2 on t1.id&#x3D;t2.ref</span><br><span class="line">    -&gt; where t1.id&#x3D;1;</span><br></pre></td></tr></table></figure>

<ul>
<li>可以发现在<code>inner join</code>建立起需要删除的关系，删除什么由<code>where</code>决定</li>
<li>需要删除表的关系由<code>delete t1,t2</code> 的表数量决定</li>
</ul>
<hr>
<h4 id="10-3-3-cascade-with-child-table"><a href="#10-3-3-cascade-with-child-table" class="headerlink" title="10.3.3 cascade with child table"></a>10.3.3 cascade with child table</h4><blockquote>
<p>通过<code>foreign key</code>建立父表子表的关系，当删除父表时，cascade的使用会使子表的相关数据自动删除</p>
</blockquote>
<ol>
<li><strong>建立子表rooms， 父表buildings</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table buildings(</span><br><span class="line">    -&gt; building_no int primary key auto_increment,</span><br><span class="line">    -&gt; building_name varchar(255),</span><br><span class="line">    -&gt; address varchar(255));</span><br><span class="line">   </span><br><span class="line">mysql&gt; create table rooms(</span><br><span class="line">    -&gt; room_no int primary key auto_increment,</span><br><span class="line">    -&gt; room_name varchar(255),</span><br><span class="line">    -&gt; building_no int,</span><br><span class="line">    -&gt; foreign key (building_no)</span><br><span class="line">    -&gt; references buildings(building_no)</span><br><span class="line">    -&gt; on delete cascade);   </span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>插入试验数据</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into buildings(building_no, building_name, address)</span><br><span class="line">    -&gt; values(1, &#39;the 1st building&#39;, &#39;1st road&#39;)</span><br><span class="line">    -&gt; ,(2, &#39;the 2nd building&#39;, &#39;2nd road&#39;)</span><br><span class="line">    -&gt; ,(3, &#39;the 3rd building&#39;, &#39;3rd road&#39;);</span><br></pre></td></tr></table></figure>

<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210226113726353.png" alt="image-20210226113726353" style="zoom:50%;" />

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into rooms(room_no, room_name, building_no)</span><br><span class="line">    -&gt; values(3, &#39;room1&#39;, 2),</span><br><span class="line">    -&gt; (5, &#39;room3&#39;, 1);</span><br></pre></td></tr></table></figure>

<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210226113807154.png" alt="image-20210226113807154" style="zoom:50%;" />

<ul>
<li>注意⚠️：在限制了<code>foreign key</code>后，<font color=red><b>子表的数据需要控制在父表的数据范围内</b></font>.换个角度也知道，分析器会分析是否有父表存在，建立父子关系前需要确保父表存在。</li>
</ul>
<ol start="3">
<li><strong>删除父表的1号楼</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; delete from buildings</span><br><span class="line">		-&gt; where building_no&#x3D;1;</span><br></pre></td></tr></table></figure>

<p>在这里只会提示<code>1 row affected</code>，但实际上子表的相关数据也被删除了：</p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210226114328752.png" alt="image-20210226114328752" style="zoom:50%;" />

<hr>
<p><strong>Summary</strong></p>
<ul>
<li>关于<code>cascade</code>父子表的删除操作仅有存储引擎「storage engine」可以完成，如<code>InnoDB</code></li>
<li>而一些表引擎是不支持<code>foreign key</code>，如<code>MyISAM</code>,因此建表前需要分析是否需要<code>cascade</code>的操作</li>
</ul>
<blockquote>
<p>mysql当中提供了可以查找父子表关系的处理方式：</p>
</blockquote>
<p>这其中要调用最底层的<code>information_schema</code>数据库</p>
<p>以<code>empdb</code>中的<code>buidings</code>和<code>rooms</code>为例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use information_schema</span><br><span class="line"></span><br><span class="line">mysql&gt; select table_name</span><br><span class="line">    -&gt; from referential_constraints</span><br><span class="line">    -&gt; where constraints_schema&#x3D;&#39;empdb&#39;</span><br><span class="line">    -&gt; and referenced_table_name&#x3D;&#39;buildings&#39;</span><br><span class="line">    -&gt; and delete_rule&#x3D;&#39;cascade&#39;;</span><br></pre></td></tr></table></figure>

<p>在底层数据库中，参数配置已经规定，直接使用即可</p>
<p><strong>general structure</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select table_name</span><br><span class="line">    -&gt; from referential_constraints</span><br><span class="line">    -&gt; where constraints_schema&#x3D;&#39;operated_database&#39;</span><br><span class="line">    -&gt; and referenced_table_name&#x3D;&#39;parent_table_name&#39;</span><br><span class="line">    -&gt; and delete_rule&#x3D;&#39;cascade&#39;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>需要修改的仅<code>&#39; &#39;</code>内部分</p>
</blockquote>
<h4 id="10-3-4-replace-op"><a href="#10-3-4-replace-op" class="headerlink" title="10.3.4 replace op"></a>10.3.4 replace op</h4><blockquote>
<p>为mysql在sql上的拓展</p>
</blockquote>
<p>使用<code>replace</code>时会先看操作数据是否为<code>primary key | unique key</code>。如果不是，那么<code>replace</code>的操作等同于<code>insert</code></p>
<p>举个例子，先建个<code>cities</code>的新表来存储数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table cities(</span><br><span class="line">    -&gt; id int primary key auto_increment,</span><br><span class="line">    -&gt; name varchar(255),</span><br><span class="line">    -&gt; population int);</span><br><span class="line">    </span><br><span class="line">mysql&gt; insert into cities(name, population)</span><br><span class="line">    -&gt; values(&#39;new york&#39;, 15000),</span><br><span class="line">    -&gt; (&#39;los angela&#39;, 2800),</span><br><span class="line">    -&gt; (&#39;fiji&#39;, 1800);</span><br></pre></td></tr></table></figure>

<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210226122508754.png" alt="image-20210226122508754" style="zoom:50%;" />

<p>修改<code>id=2</code>的<code>population</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; replace cities(id, population)</span><br><span class="line">    -&gt; values(2, 10000);</span><br></pre></td></tr></table></figure>

<p>得到：</p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210226122557408.png" alt="image-20210226122557408" style="zoom:50%;" />

<p><strong>conclusion：</strong> <code>replace</code>的处理方式是自己新建列然后覆盖原有列，因为<code>name</code>没有赋值，默认为<code>null</code></p>
<p>再举个栗子，使用<code>replace into</code>来插入数据:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; replace into cities</span><br><span class="line">    -&gt; set id&#x3D;4,</span><br><span class="line">    -&gt; name&#x3D;&#39;phoenix&#39;,</span><br><span class="line">    -&gt; population&#x3D;178690;</span><br></pre></td></tr></table></figure>

<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210226123409851.png" alt="image-20210226123409851" style="zoom:50%;" />

<p>与<code>update</code>不同，如果在这里没有规定值，则会采取默认值填充</p>
<h5 id="Appendix：-replace-rows-by-selecting-other-table"><a href="#Appendix：-replace-rows-by-selecting-other-table" class="headerlink" title="Appendix： replace rows by selecting other table"></a><strong>Appendix：</strong> replace rows by selecting other table</h5><blockquote>
<p>引用其他表的数据来更新整个列</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; replace into table_name(column_name)</span><br><span class="line">		-&gt; select chosen_column_name</span><br><span class="line">		-&gt; from chosen_table</span><br><span class="line">		-&gt; where 「condition」</span><br></pre></td></tr></table></figure>

<h3 id="10-4-prepared-usgae"><a href="#10-4-prepared-usgae" class="headerlink" title="10.4 prepared usgae"></a>10.4 prepared usgae</h3><p>这个是<code>mysql 4.1+</code>后更新的新的用法，用来规范语法格式，像是mysql中的有参函数。主要的过程为：<br>$$<br>prepare \rightarrow execute(circle)\rightarrow deallocate\ prepare<br>$$<br>以<code>classicmodels</code>中的<code>products</code>为例</p>
<ol>
<li>先定义prepare语句</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; prepare stm from</span><br><span class="line">    -&gt; &#39;select productcode, productname </span><br><span class="line">    -&gt; from products </span><br><span class="line">    -&gt; where productcode&#x3D;?&#39;;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>命名where代表的变量</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set @pc&#x3D;&#39;S10_1678&#39;;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>执行该函数</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; execute stm using @pc;</span><br></pre></td></tr></table></figure>

<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210226125523596.png" alt="image-20210226125523596" style="zoom:50%;" />

<ol start="4">
<li>释放函数所占空间</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; deallocate prepare stm;</span><br></pre></td></tr></table></figure>

<h2 id="11-Transaction"><a href="#11-Transaction" class="headerlink" title="11 Transaction"></a>11 Transaction</h2><blockquote>
<p>同时介绍<code>rollup</code>及<code>commit</code></p>
</blockquote>
<p><code>transaction</code>用来防止在一系列操作的过程中，有数据没有被传入表中。如果在这一连串操作中，有数据没有导入，则返回原始状态；如果正常进行，则对数据库进行全部操作。</p>
<h3 id="11-1-transaction-statement"><a href="#11-1-transaction-statement" class="headerlink" title="11.1 transaction statement"></a>11.1 transaction statement</h3><p><code>mysql</code>在<code>transaction</code>方面提供了以下操作：</p>
<ul>
<li>去运行transaction，使用<code>start transaction</code>，或者采用别名<code>begin/begin work</code>.</li>
<li>提交transaction操作并进行永久改变，采用<code>commit</code></li>
<li>召回<code>transaction</code>操作并取消原先操作，采用<code>roll back</code></li>
<li>限制数据库自动commit，设置<code>set autocommit</code></li>
</ul>
<p>默认条件下，一般认为会永久改变数据库，在如何修改自动提交的操作如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">% constraint auto_commit</span><br><span class="line">mysql&gt; set autocommit &#x3D; off;</span><br><span class="line">mysql&gt; set autocommit &#x3D; 0;</span><br><span class="line"></span><br><span class="line">% start auto_commit</span><br><span class="line">mysql&gt; set autocommit &#x3D; on;</span><br><span class="line">mysql&gt; set autocommit &#x3D; 1;</span><br></pre></td></tr></table></figure>

<p><strong>Example:</strong></p>
<blockquote>
<p><code>orders</code> &amp; <code>orderdetails</code> 表</p>
</blockquote>
<blockquote>
<p>为了能更好的使用transaction，我们必须将transaction的各个操作的逻辑顺序整理出来，决定在这个过程中使用什么数据</p>
</blockquote>
<p>假设现在在orders中新增一名顾客的信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">% start transaction</span><br><span class="line">mysql&gt; start transaction;</span><br><span class="line"></span><br><span class="line">% get inserted ordernumber</span><br><span class="line">mysql&gt; select </span><br><span class="line">    -&gt; @ordernumber :&#x3D; max(ordernumber)+1</span><br><span class="line">    -&gt; from orders;</span><br><span class="line">    </span><br><span class="line">% insert manipulated data</span><br><span class="line">%% in orders</span><br><span class="line">mysql&gt; insert into orders(ordernumber, orderdate, requireddate, shippeddate, status, customernumber)</span><br><span class="line">    -&gt; values(@ordernumber, &#39;2021-02-27&#39;, &#39;2021-02-28&#39;, &#39;2021-03-01&#39;, &#39;In Process&#39;, 145);</span><br><span class="line">    </span><br><span class="line">%% in orderdetails</span><br><span class="line">mysql&gt; insert into orderdetails(ordernumber, productcode, quantityordered, priceeach, orderlinenumber)</span><br><span class="line">    -&gt; values(@ordernumber, &#39;S18_1749&#39;, 30, 100.1, 1),</span><br><span class="line">    -&gt; (@ordernumber, &#39;S18_2248&#39;, 50, 21.17, 2);</span><br><span class="line"></span><br><span class="line">% commit change</span><br><span class="line">mysql&gt; commit;</span><br></pre></td></tr></table></figure>

<p><strong>怎么去查看插入的新信息呢？</strong></p>
<p>在选择插入值的时候得到<code>@ordernumber = 10426</code>，在<code>select</code>中选择对应的列，如果希望引用其他表的数据，使用<code>join</code>的方式引入多表的表现数据</p>
<h3 id="11-2-ROLLBACK-op"><a href="#11-2-ROLLBACK-op" class="headerlink" title="11.2 ROLLBACK op"></a>11.2 ROLLBACK op</h3><blockquote>
<p>如果希望撤销之前的<code>transaction</code>操作，可以采用<code>roll back</code>的方式</p>
</blockquote>
<p>以<code>orders</code>为例</p>
<blockquote>
<p>这里需要用的删除的表是没有<code>cascade</code>关系的</p>
</blockquote>
<ul>
<li><strong>1st session</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; start transaction;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; delete from orders;</span><br><span class="line">Query OK, 327 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>然而另开一个<code>session</code></strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select count(*) ordernumber</span><br><span class="line">		-&gt; from orders;</span><br><span class="line"></span><br><span class="line">+-------------+</span><br><span class="line">| ordernumber |</span><br><span class="line">+-------------+</span><br><span class="line">|         327 |</span><br><span class="line">+-------------+</span><br></pre></td></tr></table></figure>

<p>因此在这些地方我们能够把<code>transaction</code>视为mysql当中开了一个虚拟空间，对原有数据进行了虚拟操作，当<code>commit</code>时该空间的操作生效，<code>roll up</code>时无事发生</p>
<p>为了保证数据完整，我们<code>rollback</code>全部操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; rollback;</span><br><span class="line">0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<h3 id="11-3-locking-table"><a href="#11-3-locking-table" class="headerlink" title="11.3 locking table"></a>11.3 locking table</h3><p>采用<code>locking</code>的原因是为了避免，<code>当一个客户端获取数据时，有其他客户端来修改数据</code>⤫：</p>
<ul>
<li><code>locking</code>仅对个人，避免的事其他<code>session</code>影响数据</li>
<li><code>locking</code>间<code>client session</code>不能互相影响，即互相设锁</li>
</ul>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210227104205791.png" alt="image-20210227104205791" style="zoom:50%;" />

<h4 id="11-3-1-general-structure"><a href="#11-3-1-general-structure" class="headerlink" title="11.3.1  general structure"></a>11.3.1  general structure</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; lock tables table1_name &#123;read | write&#125;,</span><br><span class="line">                   table2_name &#123;read | write&#125;,</span><br><span class="line">                   ...;</span><br></pre></td></tr></table></figure>

<p><code>locking</code>中存在两种模式：<code>read</code>和<code>write</code>，建立个新表<code>messages</code>进行讨论</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table messages(</span><br><span class="line">    -&gt; id int primary key auto_increment,</span><br><span class="line">    -&gt; message varchar(255) default null);</span><br></pre></td></tr></table></figure>

<p>设置初始值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into messages(message)</span><br><span class="line">    -&gt; values(&#39;the 1st example&#39;);</span><br></pre></td></tr></table></figure>

<h4 id="11-3-2-read-lock"><a href="#11-3-2-read-lock" class="headerlink" title="11.3.2 read lock"></a>11.3.2 read lock</h4><p><strong>Features:</strong></p>
<ul>
<li>当<code>read lock</code>所在的<code>session</code>正常或者异常终止时，会使所有的<code>lock</code>都自动解开</li>
<li>设置<code>read lock</code>的<code>session</code>也只能<code>read</code>，不能执行<code>write</code>的操作。此时所有的<code>sessions</code>的<code>write</code>操作都会放在<code>writing line</code>当中</li>
</ul>
<p><strong>如何解锁？</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; unlock tables;</span><br></pre></td></tr></table></figure>

<p><strong>以两个session的读写操作为例：</strong></p>
<blockquote>
<p>1st 表示第一个设置<code>read lock</code>的<code>session</code>， 2nd表示试图插入数据的<code>session</code></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-----1. show the demo sessions ports -----</span><br><span class="line">% 1st</span><br><span class="line">mysql&gt; select connection_id();</span><br><span class="line">2036;</span><br><span class="line"></span><br><span class="line">% 2nd</span><br><span class="line">mysql&gt; select connection_id();</span><br><span class="line">2038;</span><br><span class="line"></span><br><span class="line">-----2. set read lock in 1st session -----</span><br><span class="line">% 1st</span><br><span class="line">mysql&gt; lock tables messages read;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">% 2nd tries to insert into data</span><br><span class="line">mysql&gt; insert into messages(message)</span><br><span class="line">    -&gt; values(&#39;the read_1st example&#39;);</span><br></pre></td></tr></table></figure>

<p>在这个时候， <code>2nd session</code>处于<code>waiting</code>的状态，来<code>check</code>一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show processlist;</span><br></pre></td></tr></table></figure>

<p>![image-20210227113723897](/Users/zoriswang/Library/Application Support/typora-user-images/image-20210227113723897.png)</p>
<p>可以看到<code>id: 2038</code>处于<code>waiting</code>的状态</p>
<p>当解锁后：<code>mysql&gt; unlock tables;</code></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210227113851214.png" alt="image-20210227113851214" style="zoom:50%;" />

<p>显示的时段是等待锁解开放入数据的时长，如果实在设置<code>read lock</code>的进程间设锁，则会出现这种情况：</p>
<p>![image-20210227114032231](/Users/zoriswang/Library/Application Support/typora-user-images/image-20210227114032231.png)</p>
<h4 id="11-3-3-write-lock"><a href="#11-3-3-write-lock" class="headerlink" title="11.3.3 write lock"></a>11.3.3 write lock</h4><p><strong>Features：</strong></p>
<ul>
<li>设置<code>write lock</code>的<code>session</code>是唯一可以对表进行读写操作的进程</li>
<li>其他<code>sessions</code>都不能够读取或者写数据直到<code>lock released</code></li>
</ul>
<p>当锁解开后，这些数据仍会被写入，这里就不展示了，过程跟read相似。</p>
<p><strong><code>read lock</code>和<code>write lock</code>的区别</strong></p>
<ul>
<li><strong><code>read lock</code>类似于<code>shared lock</code>，</strong>所有<code>session</code>都能够读取数据，对于设锁的<code>session</code>其不能写数据，对于其他<code>session</code>写入时会先在<code>waiting line</code>等待，直到<code>lock released</code>后，数据写入</li>
<li><strong><code>write lock</code>类似于<code>exclusive lock</code>，</strong>设锁的<code>session</code>可以进行读写操作，其他<code>session</code>没有读写操作的权限</li>
</ul>
<h2 id="12-Managing-MySQL-Databases-amp-Tables"><a href="#12-Managing-MySQL-Databases-amp-Tables" class="headerlink" title="12 Managing MySQL Databases &amp; Tables"></a>12 Managing MySQL Databases &amp; Tables</h2><h3 id="12-1-basic-ops-about-database"><a href="#12-1-basic-ops-about-database" class="headerlink" title="12.1 basic ops about database"></a>12.1 basic ops about database</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">% 显示该ip下有的数据库</span><br><span class="line"></span><br><span class="line">mysql&gt; use database_name;</span><br><span class="line">% 使用该数据库</span><br></pre></td></tr></table></figure>

<h3 id="12-2-Drop-database"><a href="#12-2-Drop-database" class="headerlink" title="12.2 Drop database"></a>12.2 Drop database</h3><p><code>Drop database</code>会永久删除数据库，谨慎操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;  drop database 「if exists」 database_name;</span><br></pre></td></tr></table></figure>

<p>返回的为你删除了该数据库中的多少张表</p>
<ul>
<li>在mysql中，<code>schema</code>与<code>database</code>为同义词</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; drop schema 「if exists」 database_name;</span><br></pre></td></tr></table></figure>

<p>产生的效果是一样的</p>
<h3 id="12-3-basic-ops-about-table"><a href="#12-3-basic-ops-about-table" class="headerlink" title="12.3 basic ops about table"></a>12.3 basic ops about table</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table if not exists table_name(</span><br><span class="line">		-&gt; column_name1, </span><br><span class="line">		-&gt; column_name2,</span><br><span class="line">  	-&gt; ...</span><br><span class="line">		-&gt; table constraints</span><br><span class="line">		-&gt; )engine&#x3D;storage_engine;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>Table_name</code>不能与<code>database_name</code>相同， <code>if not exists</code>作为缺省项有时会带来很大帮助</li>
</ul>
<h3 id="12-4-columns’-definition"><a href="#12-4-columns’-definition" class="headerlink" title="12.4 columns’ definition"></a>12.4 columns’ definition</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">column_name data_type(length) [NOT NULL] [DEFAULT value] [AUTO_INCREMENT] column_constraint;</span><br></pre></td></tr></table></figure>

<p>在column_constraint 处，可以设置<code>unique</code>, <code>check</code>, <code>primary key</code>等联系词，其中<code>primary key</code>可以设置一列或多列：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">primary key(col1, col2, ..., coln);</span><br></pre></td></tr></table></figure>

<h3 id="12-5-sequence"><a href="#12-5-sequence" class="headerlink" title="12.5 sequence"></a>12.5 sequence</h3><blockquote>
<p><code>Sequence</code>在mysql中在表中生成唯一有序的ID</p>
</blockquote>
<p><strong>实际应用：</strong> 在<code>CRM</code>中我们需要随机生成客户的ID, <code>HR</code>方面需要设置连续的雇员号码等</p>
<blockquote>
<p>为了能自动生成有序的序号，需要对对应列设置<code>auto_increment</code>，一般都为<code>primary key</code></p>
</blockquote>
<p>使用<code>auto_increment</code>的几个规则：</p>
<ul>
<li>每个表只能有一个<code>auto_increment</code>的列，通常数据类型为整数</li>
<li>这个<code>auto_increment</code>必须具有索引，这说明其必须约束为<code>primary key</code>或<code>unique key</code></li>
<li><code>auto_increment</code>一定<code>not null</code>，在设置相关数据类型时mysql自动修正为<code>not null</code></li>
</ul>
<p><strong>更便捷的使用</strong></p>
<ul>
<li><p>为了获得最后一行的序号，方便插入，使用函数<code>last_insert_id()</code>获得</p>
</li>
<li><p>当你插入的新对象的<code>new id</code>大于当前表的最后一行时，会使用<code>new id</code>，而之后的<code>sequence</code>依旧以原来的<code>id</code>为主，由此会产生原有的<code>id</code>与<code>new id</code>间的<code>gap</code></p>
</li>
<li><p>如果使用了<code>delete</code>来删除行，该<code>id</code>会不会再出现取决于使用的<code>storage engine</code>。如<code>MyISAM</code>,<code>InnoDB</code>不会使用</p>
</li>
</ul>
<p>对上述的知识做个全流程示范：</p>
<ol>
<li><strong>建立新表employees</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table if not exists employees(</span><br><span class="line">    -&gt; emp_no int auto_increment,</span><br><span class="line">    -&gt; first_name varchar(255) not null,</span><br><span class="line">    -&gt; last_name varchar(255) not null,</span><br><span class="line">    -&gt; primary key(emp_no)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>插入数据</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into employees(first_name, last_name)</span><br><span class="line">    -&gt; values(&#39;1st&#39;, &#39;example&#39;),</span><br><span class="line">    -&gt; (&#39;2nd&#39;, &#39;example&#39;);</span><br></pre></td></tr></table></figure>

<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210303162806780.png" alt="image-20210303162806780" style="zoom:50%;" />

<ol start="3">
<li><strong>删除第二个数据</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; delete from employees</span><br><span class="line">    -&gt; where emp_no&#x3D;2;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>插入第三个数据，观察此时的<code>emp_no</code></strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into employees(first_name, last_name)</span><br><span class="line">    -&gt; values(&#39;3rd&#39;, &#39;example&#39;);</span><br></pre></td></tr></table></figure>

<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210303163104385.png" alt="image-20210303163104385" style="zoom:50%;" />

<p>因为系统默认的存储引擎为<code>InnoDB</code>, 在该存储引擎下，删除的<code>ID</code>不会二次出现</p>
<ol start="5">
<li><strong>改变第三个数据的<code>emp_no</code>，插入第四个数据，观察<code>emp_no</code>为<code>11</code>还是<code>4</code></strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update employees</span><br><span class="line">    -&gt; set</span><br><span class="line">    -&gt; emp_no&#x3D;10,</span><br><span class="line">    -&gt; first_name&#x3D;&#39;4th&#39;</span><br><span class="line">    -&gt; where emp_no&#x3D;3;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意这里<code>update</code>是表，之后才是<code>set</code>相关属性</p>
</blockquote>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210303163701243.png" alt="image-20210303163701243" style="zoom:50%;" />

<p><strong>插入第4个数据</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into employees(first_name, last_name)</span><br><span class="line">    -&gt; values(&#39;4th_insert&#39;, &#39;example&#39;);</span><br></pre></td></tr></table></figure>

<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210303163905919.png" alt="image-20210303163905919" style="zoom:50%;" />

<p><strong>可以看到，此时插入的数据依旧是<code>emp_no</code>原来的<code>ID</code>自动<code>auto_increment</code>的结果</strong></p>
<h3 id="12-6-Alter-table"><a href="#12-6-Alter-table" class="headerlink" title="12.6 Alter table"></a>12.6 Alter table</h3><blockquote>
<p>这里主要介绍如何加列，改变列，重命名列，删除列及重命名表</p>
</blockquote>
<p><strong>先建立个示例表<code>vehicles</code></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table if not exists vehicles(</span><br><span class="line">    -&gt; vehicle_id int primary key,</span><br><span class="line">    -&gt; year int not null,</span><br><span class="line">    -&gt; make varchar(255));</span><br></pre></td></tr></table></figure>

<h4 id="lt-1-gt-add-a-single-column"><a href="#lt-1-gt-add-a-single-column" class="headerlink" title="&lt;1&gt; add a single column"></a>&lt;1&gt; add a single column</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alter table table_name</span><br><span class="line">add new_column_name column_definition</span><br><span class="line">「first | after column_name」;</span><br></pre></td></tr></table></figure>

<ul>
<li>其中<code>first</code>指新增列插入表中作为首列</li>
</ul>
<p>插入新列<code>model varchar(255)</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table employees</span><br><span class="line">		-&gt; add model varchar(255) not null;</span><br></pre></td></tr></table></figure>

<p>查看表内结构：<code>descirbe employees</code></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210303170453040.png" alt="image-20210303170453040" style="zoom:50%;" />

<h4 id="lt-2-gt-add-multi-columns-alter-add"><a href="#lt-2-gt-add-multi-columns-alter-add" class="headerlink" title="&lt;2&gt; add multi columns alter ... add"></a>&lt;2&gt; <strong>add multi columns <code>alter ... add</code></strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table vehicles</span><br><span class="line">    -&gt; add color varchar(50),</span><br><span class="line">    -&gt; add note varchar(255);</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; describe vehicles;</span><br></pre></td></tr></table></figure>

<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210303200640664.png" alt="image-20210303200640664" style="zoom:50%;" />

<h4 id="lt-3-gt-change-multi-columns-by-Modify"><a href="#lt-3-gt-change-multi-columns-by-Modify" class="headerlink" title="&lt;3&gt; change multi columns by Modify"></a>&lt;3&gt; <strong>change multi columns by <code>Modify</code></strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">alter table table_name</span><br><span class="line">modify column_name column_definition</span><br><span class="line">[first | after column_name],</span><br><span class="line">modify column_name column_definition</span><br><span class="line">[...];</span><br></pre></td></tr></table></figure>

<p><strong>举个栗子：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table vehicles</span><br><span class="line">    -&gt; modify color varchar(50) not null,</span><br><span class="line">    -&gt; modify note varchar(255) not null;</span><br></pre></td></tr></table></figure>

<p><strong>Result:</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210303200711742.png" alt="image-20210303200711742" style="zoom:50%;" />

<ul>
<li>在<code>modify</code>中，我们能够重新定义列，修改对象的大小，数据类型等</li>
</ul>
<h4 id="lt-4-gt-change-columns"><a href="#lt-4-gt-change-columns" class="headerlink" title="&lt;4&gt; change columns"></a>&lt;4&gt; change columns</h4><p><strong>general structure：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alter tabel table_name</span><br><span class="line">change column original_name new_name column_defnition</span><br><span class="line">[first | after column_name]</span><br></pre></td></tr></table></figure>

<p>举个栗子「修改<code>note</code>为<code>colornote</code>」:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table vehicles </span><br><span class="line">    -&gt; change column color colornote varchar(100)</span><br><span class="line">    -&gt; after make;</span><br></pre></td></tr></table></figure>

<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210303201805449.png" alt="image-20210303201805449" style="zoom:50%;" />

<h4 id="lt-5-gt-drop-columns"><a href="#lt-5-gt-drop-columns" class="headerlink" title="&lt;5&gt; drop columns"></a>&lt;5&gt; drop columns</h4><p><strong>general structure:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table_name</span><br><span class="line">drop column_name;</span><br></pre></td></tr></table></figure>

<h4 id="lt-6-gt-rename-table"><a href="#lt-6-gt-rename-table" class="headerlink" title="&lt;6&gt; rename table"></a>&lt;6&gt; rename table</h4><p><strong>general structure:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table_name</span><br><span class="line">rename to new_table_name;</span><br></pre></td></tr></table></figure>

<p>举个栗子：</p>
<ul>
<li><strong>original tables</strong></li>
</ul>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210303202248835.png" alt="image-20210303202248835" style="zoom:50%;" />

<ul>
<li><strong>rename process</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table vehicles</span><br><span class="line">rename to cars</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>final result</strong></li>
</ul>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210303202458021.png" alt="image-20210303202458021" style="zoom:50%;" />

<h3 id="12-7-renaming-table-using-rename-statement"><a href="#12-7-renaming-table-using-rename-statement" class="headerlink" title="12.7 renaming table using rename statement"></a>12.7 renaming table using rename statement</h3><p>为了能更便捷地<code>rename tables</code>,使用以下语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rename table old_table_name to new_table_name;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><font color=red><b>注意：</b></font> </p>
<ul>
<li>在<code>rename</code>前需要确保此时没有<code>transaction</code>及<code>lock tables</code></li>
<li>对于<code>temporary table</code>，<code>rename table</code>无定义行为，只能采用<code>alter table</code>的方法</li>
</ul>
</blockquote>
<p>如何新建<code>temporary table</code>，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create temporary tabel [if exists] table_name();</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>查找表中存在的列</strong></li>
</ul>
<blockquote>
<p>当表中有上百列时，查找会变得很困难，在之前最好先<code>check</code>一下</p>
</blockquote>
<p>关于列的信息存储于<code>information_schema</code>数据库中的<code>columns</code>表内，查找方式为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select</span><br><span class="line">    -&gt; if(count(*)&#x3D;1, &#39;exist&#39;, &#39;not wxist&#39;) as result</span><br><span class="line">    -&gt; from information_schema.columns</span><br><span class="line">    -&gt; where table_schema&#x3D;&#39;classicmodels&#39;</span><br><span class="line">    -&gt; and table_name&#x3D;&#39;employees&#39;</span><br><span class="line">    -&gt; and column_name&#x3D;&#39;lastName&#39;;</span><br></pre></td></tr></table></figure>

<h3 id="12-8-drop-columns"><a href="#12-8-drop-columns" class="headerlink" title="12.8 drop columns"></a>12.8 drop columns</h3><p><strong>general structure</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table table_name</span><br><span class="line">		-&gt; drop column_name1,</span><br><span class="line">		-&gt; drop column_name2,</span><br><span class="line">		-&gt; ...;</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong> 删除列时，需要考虑该列是否涉及到其他列，对于大型数据库，删除关系列消耗会较大</p>
<p>举个删除非关系列和关系列的🌰</p>
<ol>
<li><strong>建立新表</strong></li>
</ol>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210304161640671.png" alt="image-20210304161640671" style="zoom:50%;" />

<ol start="2">
<li><strong>删除<code>content</code>列</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table posts</span><br><span class="line">    -&gt; drop content;</span><br></pre></td></tr></table></figure>

<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210304161832694.png" alt="image-20210304161832694" style="zoom:50%;" />

<ul>
<li><strong>Drop a column is a foreign key</strong></li>
</ul>
<ol>
<li><strong>建立新表<code>categories</code></strong></li>
</ol>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210304163317792.png" alt="image-20210304163317792" style="zoom:50%;" />

<ol start="2">
<li><strong>往<code>posts</code>中加入新列<code>categories_id</code></strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table posts</span><br><span class="line">    -&gt; add categorie_id int not null;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>约束两列关系</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table posts</span><br><span class="line">    -&gt; add constraint fk_cat</span><br><span class="line">    -&gt; foreign key (categorie_id)</span><br><span class="line">    -&gt; references categories(id);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>注意：</strong> 这里加的<code>constraint</code>为<code>fk_cat</code>，<code>fk</code>表示<code>foreign_key</code></li>
<li><font color=red><b>foreign key后的约束列需要用括号括起来表示</b></font></li>
</ul>
<ol start="4">
<li><strong>观察此时两表间的关系</strong></li>
</ol>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210304164309238.png" alt="image-20210304164309238" style="zoom:50%;" />

<p>试图删除<code>categories_id</code>列：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table posts</span><br><span class="line">    -&gt; drop categorie_id;</span><br></pre></td></tr></table></figure>

<p><strong>系统显示：</strong></p>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210304164737689.png" alt="image-20210304164737689" style="zoom:50%;" />

<h3 id="12-9-drop-tables"><a href="#12-9-drop-tables" class="headerlink" title="12.9 drop tables"></a>12.9 drop tables</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; drop [temporary] table [if exists] table[, table, ...] ...</span><br><span class="line">[restrict | cascade]</span><br></pre></td></tr></table></figure>

<ul>
<li>mysql中，如果希望删除多表，使用<code>,</code>来分隔选择删除的表</li>
<li>加入<code>temporary</code>来删除<code>temporary table</code></li>
</ul>
<h4 id="12-9-1-drop-table-based-on-a-pattern"><a href="#12-9-1-drop-table-based-on-a-pattern" class="headerlink" title="12.9.1 drop table based on a pattern"></a>12.9.1 drop table based on a pattern</h4><p>假设你希望删除一推名为<code>testx</code>的表，但是mysql中没有提供</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; drop table like &#39;%pattern%&#39;</span><br></pre></td></tr></table></figure>

<p>但是可以采取相似的方式来处理重样式表格，假设建立<code>test1,..2,..3</code>表格：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table test1(</span><br><span class="line">    -&gt; id int primary key auto_increment,</span><br><span class="line">    -&gt; name varchar(255) not null);</span><br><span class="line">    </span><br><span class="line">mysql&gt; create table test2 like test1;</span><br><span class="line">mysql&gt; create table test3 like test1;</span><br></pre></td></tr></table></figure>

<p><strong>现在需要删除全部<code>testx</code>的表格</strong></p>
<ol>
<li>先设置<code>schema</code>和<code>pattern</code>「在<code>mysql</code>中<code>schema</code>通常用于表示<code>database</code>」</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set @schema&#x3D;&#39;classicmodels&#39;;</span><br><span class="line">mysql&gt; set @pattern&#x3D;&#39;test%&#39;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意：</strong> <code>set</code>后的变量需要用<code>&#39; &#39;</code>来包括</p>
</blockquote>
<ol start="2">
<li>设置新变量来代替需要删除的表格</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select concat(&#39;drop table&#39;, group_concat(@schema,&#39;.&#39;,table_name),&#39;;&#39;)</span><br><span class="line">    -&gt; into @droplike</span><br><span class="line">    -&gt; from information_schema.tables</span><br><span class="line">    -&gt; where @schema&#x3D;database()</span><br><span class="line">    -&gt; and table_name like @pattern;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>用<code>@droplike</code>来表示</p>
</blockquote>
<ol start="3">
<li>显示<code>dynamic sql statement</code></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select @droplike;</span><br></pre></td></tr></table></figure>

<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210304195915209.png" alt="image-20210304195915209" style="zoom:50%;" />

<ol start="4">
<li><strong>Execute dynamic sql</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">prepare stmt from @droplike;</span><br><span class="line">execute stmt;</span><br><span class="line">deallocate execute stmt;</span><br></pre></td></tr></table></figure>

<p>之后，如果有需要删除的共同缀落表，可以采用以上方式来消除。</p>
<p>如果经常执行相关操作，可以往<code>storage engine</code>上升级</p>
<h3 id="12-10-truncate-table"><a href="#12-10-truncate-table" class="headerlink" title="12.10 truncate table"></a>12.10 truncate table</h3><p>如果需要直接删除表，可以采用truncate的方式来删除表</p>
<p><strong>general structure</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; truncate table table_name</span><br></pre></td></tr></table></figure>

<ul>
<li>如果该表有<code>foreign key</code>的话，该<code>truncate statement</code>将会失效</li>
</ul>
<h2 id="13-Mysql-Datatype"><a href="#13-Mysql-Datatype" class="headerlink" title="13 Mysql Datatype"></a>13 Mysql Datatype</h2><img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210304201708441.png" alt="image-20210304201708441" style="zoom:50%;" />

<p>以上是几个容易出现的类型，接下来说几个特殊的类型</p>
<h3 id="13-1-bit-examples"><a href="#13-1-bit-examples" class="headerlink" title="13.1 bit examples"></a>13.1 bit examples</h3><blockquote>
<p>注意这个特性只存在于mysql 5.7+内</p>
</blockquote>
<p>当定义某个属性为<code>bit</code>型时，表示其为二进制的数，其最后呈现结果为十进制的数</p>
<p>举个栗子</p>
<ol>
<li><strong>新建立一个表<code>working_calendar</code></strong></li>
</ol>
<img src="/Users/zoriswang/Library/Application Support/typora-user-images/image-20210305142715804.png" alt="image-20210305142715804" style="zoom:50%;" />

<ol start="2">
<li><strong>插入数据</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; INSERT INTO working_calendars(y,w,days)</span><br><span class="line">    -&gt; VALUES(2017,1,B&#39;1111100&#39;);</span><br></pre></td></tr></table></figure>

<p>此时的<code>days</code>在<code>select 时</code>呈现的将是整数形式， 即<code>days=124</code></p>
<p>当填充的二维进制位数少于其定义的类型时，<code>mysql</code>会自动补充<code>0</code></p>
<ol start="3">
<li><strong>显示数据</strong></li>
</ol>
<p>直接选择原填充的少于<code>n</code>的数据时，假如填充的是<code>111100</code>，mysql在处理时自动补了<code>0</code>，但是显示时仍旧为<code>111100</code>，这个时候如果希望显示正确的<code>0111100</code>，则需要将语句改为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select y, w, lapd(bin(days), 7, 0)</span><br><span class="line">from working_calendars</span><br></pre></td></tr></table></figure>

<p>这个时候显示的即是<code>0111100</code></p>
<h3 id="13-2-json-amp-enum"><a href="#13-2-json-amp-enum" class="headerlink" title="13.2 json &amp; enum"></a>13.2 json &amp; enum</h3><p>这两个数据类型因为我目前没用过，所以这里就不介绍了qwq</p>
<h2 id="14-Mysql-constraints"><a href="#14-Mysql-constraints" class="headerlink" title="14 Mysql constraints"></a>14 Mysql constraints</h2><h3 id="14-1-not-null-constraints"><a href="#14-1-not-null-constraints" class="headerlink" title="14.1 not null constraints"></a>14.1 not null constraints</h3><p>在定义表内属性类型时防<code>null</code>时，在数据类型后加<code>not null</code>即可，为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">column_name column_type not null;</span><br></pre></td></tr></table></figure>

<h4 id="lt-1-gt-add-not-null-to-existing-columns"><a href="#lt-1-gt-add-not-null-to-existing-columns" class="headerlink" title="&lt;1&gt; add not null to existing columns"></a>&lt;1&gt; add <code>not null</code> to existing columns</h4><p>一般修改<code>column</code>不为<code>null</code>，采取以下三个步骤</p>
<ol>
<li>检查当前的<code>columns</code>是否为<code>null</code></li>
<li>使用<code>change</code>修改<code>column</code>属性</li>
<li>使用<code>modify</code>修改<code>column</code>属性</li>
</ol>
<p><strong>修改方法1: 通过<code>update</code>中的<code>set</code>来修改为<code>null</code>的属性</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">update table_name</span><br><span class="line">	set  is_null_column_name&#x3D;想要修改的值</span><br><span class="line">	where is_null_column_name&#x3D;null</span><br></pre></td></tr></table></figure>

<p><strong>修改方法2: 使用<code>modify</code>修改原有的属性</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table table_name</span><br><span class="line">	change old_column_name new_column_name column_definition </span><br></pre></td></tr></table></figure>

<h4 id="lt-2-gt-drop-a-not-null-constraint"><a href="#lt-2-gt-drop-a-not-null-constraint" class="headerlink" title="&lt;2&gt; drop a not null constraint"></a>&lt;2&gt; drop a not null constraint</h4><p>查看选定的<code>column</code>是否为空，还可以通过<code>describe table_name</code>来查看</p>
<p>在重新设定<code>column</code>属性时，目前来讲最方便的还是<code>modify</code>的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table table_name</span><br><span class="line">	change old_column_name new_column_name column_definition </span><br></pre></td></tr></table></figure>

<h3 id="14-2-primary-key"><a href="#14-2-primary-key" class="headerlink" title="14.2 primary key"></a>14.2 primary key</h3><h4 id="14-2-1-introduction-to-primary-key"><a href="#14-2-1-introduction-to-primary-key" class="headerlink" title="14.2.1 introduction to primary key"></a>14.2.1 introduction to primary key</h4><p><code>primary key</code>可以为一列或是多列，但需要遵从以下规则：</p>
<ol>
<li><code>primary key</code>内的值必须是唯一出现的</li>
<li><code>primary key</code>中不得出现<code>null</code>值</li>
</ol>
<p><strong>注意：</strong> 因为<code>mysql</code>处理<code>integer</code>类型会较快，所以对于<code>primary key</code>一般选用<code>int</code>, <code>bigint</code>类型。但是在使用前需要确保表示的值是处于<code>int</code>,<code>bigint</code>表示范围内的</p>
<h4 id="14-2-2-define-primary-key-by-alter-add"><a href="#14-2-2-define-primary-key-by-alter-add" class="headerlink" title="14.2.2 define primary key by alter ... add"></a>14.2.2 define primary key by <code>alter ... add</code></h4><p>如果后面希望添加其他列作为<code>primary key</code>，可以采用<code>add</code>的方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table table_name</span><br><span class="line">add primary key(column_list)</span><br></pre></td></tr></table></figure>

<h4 id="14-2-3-key-V-S-primary-key-V-S-unique-key"><a href="#14-2-3-key-V-S-primary-key-V-S-unique-key" class="headerlink" title="14.2.3 key V.S primary key V.S unique key"></a>14.2.3 key V.S primary key V.S unique key</h4><h5 id="lt-1-gt-key"><a href="#lt-1-gt-key" class="headerlink" title="&lt;1&gt; key"></a>&lt;1&gt; key</h5><p><code>Key</code> 与<code>index</code>类似，但不包含在<code>primary | unique key</code> 。当希望往一列或多列中加入索引时，可以加入<code>key</code></p>
<h5 id="lt-2-gt-unique-key"><a href="#lt-2-gt-unique-key" class="headerlink" title="&lt;2&gt; unique key"></a>&lt;2&gt; unique key</h5><p>与<code>primary key</code>不同的点：</p>
<ul>
<li>允许出现<code>null</code>的值</li>
<li>对于每个表可以设置多个<code>unique key</code>，但只有一个<code>primary key</code></li>
</ul>
<h3 id="14-3-foreign-key"><a href="#14-3-foreign-key" class="headerlink" title="14.3 foreign key"></a>14.3 foreign key</h3><h4 id="14-3-1-features"><a href="#14-3-1-features" class="headerlink" title="14.3.1 features"></a>14.3.1 features</h4><ol>
<li><p>在<code>foreign key</code>中的<strong>子列的父列</strong>在其所在的表一般为<code>primary key</code></p>
</li>
<li><p>一个表可以有多个<code>foreign keys</code>，并<code>references</code>的可以是不同表</p>
</li>
</ol>
<h4 id="14-3-2-foreign-examples"><a href="#14-3-2-foreign-examples" class="headerlink" title="14.3.2 foreign examples"></a>14.3.2 foreign examples</h4><p>在这之前，专门为<code>foreign key</code>建立一个数据库<code>fkdemo</code></p>
<h5 id="lt-1-gt-connect-two-columns-in-different-tables"><a href="#lt-1-gt-connect-two-columns-in-different-tables" class="headerlink" title="&lt;1&gt;  connect two columns in different tables"></a>&lt;1&gt;  connect two columns in different tables</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table categories(</span><br><span class="line">    -&gt; categorie_id int auto_increment primary key,</span><br><span class="line">    -&gt; categorie_name varchar(255) not null);</span><br><span class="line">    </span><br><span class="line">mysql&gt; create table products(</span><br><span class="line">    -&gt; product_id int auto_increment primary key,</span><br><span class="line">    -&gt; product_name varchar(255) not null,</span><br><span class="line">    -&gt; categorie_id int,</span><br><span class="line">    -&gt; constraint fk_categorie </span><br><span class="line">    -&gt; foreign key (categorie_id) references categories(categorie_id));</span><br></pre></td></tr></table></figure>

<p>其中，<code>products</code>中的<code>category_id</code>与<code>categories</code>中的<code>category_id</code>形成父子关系</p>
<p>在这里我们没有使用<code>on update</code>和<code>on delete</code>的语法，因此全部归属在<code>default</code>关系的<code>restrict</code>中，包含了<code>update</code>和<code>delete</code>约束关系</p>
<h5 id="lt-2-gt-insert-1st-example"><a href="#lt-2-gt-insert-1st-example" class="headerlink" title="&lt;2&gt; insert 1st example"></a>&lt;2&gt; insert 1st example</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into categories(categorie_name)</span><br><span class="line">    -&gt; values(&#39;1st data&#39;), (&#39;2nd data&#39;);</span><br></pre></td></tr></table></figure>

<p>此时往<code>products</code>中插入此前没规定的<code>categorie_id</code>的值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into products(product_name, categorie_id)</span><br><span class="line">    -&gt; values(&#39;the 2nd data&#39;, 2);</span><br></pre></td></tr></table></figure>

<p>显示插入成功，说明在<code>products</code>中已经有了<code>categorie_id=2</code>的行，这个行由<code>foreign key</code>的协助下产生</p>
<p><strong>但是如果加入的<code>categorie_id</code> 大于原有的id时，会返回错误</strong></p>
<h5 id="lt-3-gt-try-to-change-gretaer-foreign-value"><a href="#lt-3-gt-try-to-change-gretaer-foreign-value" class="headerlink" title="&lt;3&gt; try to change gretaer foreign value"></a>&lt;3&gt; try to change gretaer foreign value</h5><p>尝试去把<code>categorie_id=2 ---&gt; categorie_id=100</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update categories</span><br><span class="line">    -&gt; set categorie_id&#x3D;100</span><br><span class="line">    -&gt; where categorie_id&#x3D;2;</span><br><span class="line"></span><br><span class="line">ERROR 1451 (23000): Cannot delete or update a parent row: a foreign key constraint fails (&#96;fkdemo&#96;.&#96;products&#96;, CONSTRAINT &#96;fk_categorie&#96; FOREIGN KEY (&#96;categorie_id&#96;) REFERENCES &#96;categories&#96; (&#96;categorie_id&#96;))</span><br></pre></td></tr></table></figure>

<p><strong>返回错误：</strong> 因为其联系到<code>products</code>中的<code>categorie_id=2</code>的行</p>
<h5 id="lt-4-gt-foreign-key-on-alter-table"><a href="#lt-4-gt-foreign-key-on-alter-table" class="headerlink" title="&lt;4&gt; foreign key on alter table"></a>&lt;4&gt; foreign key on alter table</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table table_name</span><br><span class="line">add constraint fk_name foreign key(column_list) references table_name(column_list)</span><br></pre></td></tr></table></figure>

<h5 id="lt-5-gt-drop-foreign-key"><a href="#lt-5-gt-drop-foreign-key" class="headerlink" title="&lt;5&gt; drop foreign key"></a>&lt;5&gt; drop foreign key</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table orders</span><br><span class="line">drop constraint fk_name;</span><br></pre></td></tr></table></figure>

<h3 id="14-4-unique-key"><a href="#14-4-unique-key" class="headerlink" title="14.4 unique key"></a>14.4 unique key</h3><h5 id="14-4-1-set-unique-key-while-creating-table"><a href="#14-4-1-set-unique-key-while-creating-table" class="headerlink" title="14.4.1 set unique key while creating table"></a>14.4.1 set unique key while creating table</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table table_name(</span><br><span class="line">column_list1 column_definition,</span><br><span class="line">...,</span><br><span class="line">unique(column_listx)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="14-4-2-set-unique-constraint-on-alter-table"><a href="#14-4-2-set-unique-constraint-on-alter-table" class="headerlink" title="14.4.2 set unique constraint on alter table"></a>14.4.2 set unique constraint on alter table</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table table_name</span><br><span class="line">set constraint uc_name unique (column_list1, column_list2,...)</span><br></pre></td></tr></table></figure>

<h5 id="14-4-3-drop-unique-constraint"><a href="#14-4-3-drop-unique-constraint" class="headerlink" title="14.4.3 drop unique constraint"></a>14.4.3 drop unique constraint</h5><blockquote>
<p>依旧使用<code>alter table</code>来完成</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table </span><br><span class="line">drop constraint unique uc_name;</span><br></pre></td></tr></table></figure>

<h3 id="14-5-check"><a href="#14-5-check" class="headerlink" title="14.5 check"></a>14.5 check</h3><h5 id="14-5-1-check-function"><a href="#14-5-1-check-function" class="headerlink" title="14.5.1 check function"></a>14.5.1 check function</h5><ul>
<li>用于限制一列的数据范围</li>
<li>如果对整个表定义了check约束，则一列的值能由同行的其他列的值来约束</li>
</ul>
<h5 id="14-5-2-check-example"><a href="#14-5-2-check-example" class="headerlink" title="14.5.2 check example"></a>14.5.2 check example</h5><h5 id="lt-1-gt-check-in-creating-table"><a href="#lt-1-gt-check-in-creating-table" class="headerlink" title="&lt;1&gt; check in creating table"></a>&lt;1&gt; check in creating table</h5><ol>
<li><strong>第一种方式–直接check</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table</span><br><span class="line">    -&gt; persons(</span><br><span class="line">    -&gt; id int primary key not null,</span><br><span class="line">    -&gt; lastname varchar(100),</span><br><span class="line">    -&gt; firstname varchar(100),</span><br><span class="line">    -&gt; age int,</span><br><span class="line">    -&gt; check (age&gt;&#x3D;18));</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>第二种方式–使用<code>constraint</code></strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table persons_again(</span><br><span class="line">    -&gt; id int primary key not null,</span><br><span class="line">    -&gt; city varchar(255),</span><br><span class="line">    -&gt; age int,</span><br><span class="line">    -&gt; constraint chk_city check (age&gt;&#x3D;18 and city&#x3D;&#39;dream_city&#39;));</span><br></pre></td></tr></table></figure>

<h5 id="lt-2-gt-check-in-alter-table-with-add"><a href="#lt-2-gt-check-in-alter-table-with-add" class="headerlink" title="&lt;2&gt; check in alter table with add"></a>&lt;2&gt; check in alter table with add</h5><p>两种方式一起写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table persons</span><br><span class="line">    -&gt; add check(age&gt;&#x3D;18);</span><br><span class="line">    </span><br><span class="line">mysql&gt; alter table persons_agdin</span><br><span class="line">		-&gt; add constraint chk_city </span><br><span class="line">		-&gt; check (age&gt;&#x3D;18 and city&#x3D;&#39;dream city&#39;);</span><br></pre></td></tr></table></figure>

<h5 id="lt-3-gt-drop-a-check-constraint"><a href="#lt-3-gt-drop-a-check-constraint" class="headerlink" title="&lt;3&gt; drop a check constraint"></a>&lt;3&gt; drop a check constraint</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table table_name</span><br><span class="line">drop check ck_name;</span><br></pre></td></tr></table></figure>

<h2 id="15-MySQL-Character-Set-amp-Collation"><a href="#15-MySQL-Character-Set-amp-Collation" class="headerlink" title="15 MySQL Character Set &amp;Collation"></a>15 MySQL Character Set &amp;Collation</h2><blockquote>
<p>这一块我不是很理解，这个地方讲解的很详细，可以看一下</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://sites.google.com/site/wen139/xiang-guan-zi-yuan/mysql-zi-fu-ji-xiang-jie">mysql字符集详解</a></p>
<h2 id="16-MySQL-export-amp-import-data"><a href="#16-MySQL-export-amp-import-data" class="headerlink" title="16 MySQL export &amp; import data"></a>16 MySQL export &amp; import data</h2><h3 id="16-1-import-csv-file-into-mysql-table"><a href="#16-1-import-csv-file-into-mysql-table" class="headerlink" title="16.1 import csv file into mysql table"></a>16.1 import csv file into mysql table</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; load data infile &quot;your csv file path&quot; </span><br><span class="line">		-&gt; into table [tablename] fields terminated by &#39;,&#39;</span><br></pre></td></tr></table></figure>

<ul>
<li>这里表示是用<code>,</code>作为分隔符；如果使用的是<code>\t</code>，则不用指明域分隔符</li>
<li>这里文件的路径需要为<strong>绝对路径</strong>，否则mysql会从数据库的默认目录下找</li>
<li>如果文件在客户端上，需要使用<code>load local data infile</code>；缺少<code>local</code>说明文件从服务端上读</li>
<li>文件绝对路径<strong>单双引号</strong>都可以</li>
</ul>
<h3 id="16-2-import-excel"><a href="#16-2-import-excel" class="headerlink" title="16.2 import excel"></a>16.2 import excel</h3><p>不需要制定分隔符，<strong>但是需要提前建立好与文件内各个段相同的数据表</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; load data infile &quot;your file path&quot;</span><br><span class="line">		-&gt; into table [tablename];</span><br></pre></td></tr></table></figure>

<h3 id="16-3-import-sql"><a href="#16-3-import-sql" class="headerlink" title="16.3 import sql"></a>16.3 import sql</h3><p>不需要提前建立数据表，直接导入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; source home&#x2F;abc&#x2F;abc.sql</span><br></pre></td></tr></table></figure>

<h2 id="17-natural-sorting"><a href="#17-natural-sorting" class="headerlink" title="17 natural sorting"></a>17 natural sorting</h2><p>这里我偷懒了，因为这一块我写了感觉我讲的不是很清楚，<code>stack overflow</code>上有过相关讨论，很详细，看这个就阔以了</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/153633/natural-sort-in-mysql">natural sort in mysql</a></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/">上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2020-2021
        <i class="ri-heart-fill heart_icon"></i> Zoris Wang
      </li>
    </ul>
    <ul>
      <li>
        
        
        
        由 <a href="https://hexo.io" target="_blank">Hexo</a> 强力驱动
        <span class="division">|</span>
        主题 - <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></s>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>
      <div class="float_btns">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

      </div>
    </main>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="Yitee"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/">区块链</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">友链</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/2021/03/16/About%20Me">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <script>
      if (window.matchMedia("(max-width: 768px)").matches) {
        document.querySelector('.content').classList.remove('on');
        document.querySelector('.sidebar').classList.remove('on');
      }
    </script>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="https://i.loli.net/2020/10/30/GFDWywm9ProCXcR.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="https://i.loli.net/2020/10/30/urJAkYB276w5gvD.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>

<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->


<script src="/js/busuanzi-2.3.pure.min.js"></script>


<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->


<link rel="stylesheet" href="/css/clipboard.css">

<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>


<!-- CanvasBackground -->


    
    <div id="music">
    
    
    
    <iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="200" height="52"
        src="//music.163.com/outchain/player?type=2&id=1332662900&auto=0&height=32"></iframe>
</div>

<style>
    #music {
        position: fixed;
        right: 15px;
        bottom: 0;
        z-index: 998;
    }
</style>
    
  </div>
</body>

</html>